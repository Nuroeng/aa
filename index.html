<!DOCTYPE html>
<!-- 
    ===========================================
    ë™ì•„ë¦¬ë°© ì˜ˆì•½ ì‹œìŠ¤í…œ - ë©”ì¸ HTML íŒŒì¼
    ===========================================
    
    ì´ íŒŒì¼ì€ ë™ì•„ë¦¬ë°© ì˜ˆì•½ ì‹œìŠ¤í…œì˜ ëª¨ë“  ê¸°ëŠ¥ì„ í¬í•¨í•œ ë‹¨ì¼ íŒŒì¼ì…ë‹ˆë‹¤.
    HTML, CSS, JavaScriptê°€ ëª¨ë‘ ì´ íŒŒì¼ ì•ˆì— ë“¤ì–´ìˆìŠµë‹ˆë‹¤.
    
    ì£¼ìš” êµ¬ì„± ìš”ì†Œ:
    1. HTML êµ¬ì¡° - ì›¹í˜ì´ì§€ì˜ ë ˆì´ì•„ì›ƒê³¼ ìš”ì†Œë“¤
    2. CSS ìŠ¤íƒ€ì¼ - ë””ìì¸ê³¼ ìƒ‰ìƒ, í¬ê¸° ë“±
    3. JavaScript ì½”ë“œ - ì‹¤ì œ ê¸°ëŠ¥ì„ ë™ì‘ì‹œí‚¤ëŠ” í”„ë¡œê·¸ë˜ë° ì½”ë“œ
    
    ìˆ˜ì • ë°©ë²•:
    - í…ìŠ¤íŠ¸ ë³€ê²½: ì›í•˜ëŠ” í…ìŠ¤íŠ¸ë¥¼ ì°¾ì•„ì„œ ë°”ê¾¸ê¸°
    - ìƒ‰ìƒ ë³€ê²½: CSS ë¶€ë¶„ì—ì„œ ìƒ‰ìƒ ì½”ë“œ ë³€ê²½
    - ê¸°ëŠ¥ ì¶”ê°€: JavaScript ë¶€ë¶„ì— ìƒˆë¡œìš´ ì½”ë“œ ì¶”ê°€
-->
<html lang="ko">
<head>
    <!-- ì›¹í˜ì´ì§€ì˜ ê¸°ë³¸ ì„¤ì • -->
    <meta charset="UTF-8"> <!-- í•œê¸€ ë“± íŠ¹ìˆ˜ë¬¸ì í‘œì‹œë¥¼ ìœ„í•œ ë¬¸ì ì¸ì½”ë”© ì„¤ì • -->
    <meta name="viewport" content="width=375, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> <!-- ëª¨ë°”ì¼ í™”ë©´ í¬ê¸° ê³ ì • (375px) -->
    <title>ë™ì•„ë¦¬ë°© ì˜ˆì•½ ì‹œìŠ¤í…œ</title> <!-- ë¸Œë¼ìš°ì € íƒ­ì— í‘œì‹œë  ì œëª© -->
    
    <!-- Tailwind CSS ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ - ë””ìì¸ì„ ì‰½ê²Œ ë§Œë“¤ê¸° ìœ„í•œ ë„êµ¬ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 
        ===========================================
        CSS ìŠ¤íƒ€ì¼ ì„¤ì • - ë””ìì¸ê³¼ ë ˆì´ì•„ì›ƒ ì •ì˜
        ===========================================
        
        CSSëŠ” ì›¹í˜ì´ì§€ì˜ ë””ìì¸ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.
        ì—¬ê¸°ì„œ ìƒ‰ìƒ, í¬ê¸°, í°íŠ¸, ë ˆì´ì•„ì›ƒ ë“±ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        
        ì£¼ìš” ìˆ˜ì • ê°€ëŠ¥í•œ í•­ëª©:
        1. ìƒ‰ìƒ ë³€ê²½: background-color, color ê°’ ë³€ê²½
        2. í¬ê¸° ë³€ê²½: width, height, font-size ê°’ ë³€ê²½  
        3. í°íŠ¸ ë³€ê²½: font-family ê°’ ë³€ê²½
        4. ê°„ê²© ì¡°ì •: margin, padding ê°’ ë³€ê²½
        */
        
        /* ì „ì²´ í˜ì´ì§€ ê¸°ë³¸ ì„¤ì • */
        body { 
            font-family: 'Pretendard', sans-serif; /* í°íŠ¸ ì„¤ì • - í•œê¸€ì— ìµœì í™”ëœ Pretendard í°íŠ¸ ì‚¬ìš© */
            margin: 0; /* í˜ì´ì§€ ì—¬ë°± ì œê±° */
            padding: 0; /* í˜ì´ì§€ ë‚´ë¶€ ì—¬ë°± ì œê±° */
            overflow-x: hidden; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }
        
        /* ë©”ì¸ ì•± ì»¨í…Œì´ë„ˆ ì„¤ì • - ì „ì²´ ì•±ì´ ë“¤ì–´ê°ˆ ì˜ì—­ */
        #app-container {
            max-width: 375px; /* ìµœëŒ€ ë„ˆë¹„ 375pxë¡œ ëª¨ë°”ì¼ í™”ë©´ í¬ê¸° ê³ ì • */
            margin: 0 auto; /* í™”ë©´ ì¤‘ì•™ì— ë°°ì¹˜ */
            min-height: 100vh; /* ìµœì†Œ ë†’ì´ë¥¼ í™”ë©´ ì „ì²´ ë†’ì´ë¡œ ì„¤ì • */
            background-color: #F8F7F4; /* ë°°ê²½ìƒ‰ ì„¤ì • - ì—°í•œ ë² ì´ì§€ìƒ‰ */
            position: relative; /* ìœ„ì¹˜ ê¸°ì¤€ì  ì„¤ì • */
        }
        
        /* í„°ì¹˜ ìµœì í™” - ëª¨ë°”ì¼ì—ì„œ í„°ì¹˜í•˜ê¸° ì‰½ê²Œ ë²„íŠ¼ í¬ê¸° ì¡°ì • */
        button, input, select, textarea {
            min-height: 44px; /* ìµœì†Œ ë†’ì´ 44px - ì†ê°€ë½ìœ¼ë¡œ í„°ì¹˜í•˜ê¸° ì¢‹ì€ í¬ê¸° */
            font-size: 16px; /* í°íŠ¸ í¬ê¸° 16px - iOSì—ì„œ ìë™ ì¤Œ ë°©ì§€ */
        }
        
        /* í„°ì¹˜ íƒ€ê²Ÿ ì„¤ì • - í„°ì¹˜ ê°€ëŠ¥í•œ ìš”ì†Œë“¤ì˜ ìµœì†Œ í¬ê¸° ë³´ì¥ */
        .touch-target {
            min-height: 44px; /* ìµœì†Œ ë†’ì´ 44px */
            min-width: 44px; /* ìµœì†Œ ë„ˆë¹„ 44px */
            display: flex; /* í”Œë ‰ìŠ¤ ë ˆì´ì•„ì›ƒ ì‚¬ìš© */
            align-items: center; /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
            justify-content: center; /* ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ */
        }
        
        /* ì˜ˆì•½ ìƒíƒœë³„ ìƒ‰ìƒ ì„¤ì • - ê° ì˜ˆì•½ ëª©ì ì— ë”°ë¼ ë‹¤ë¥¸ ìƒ‰ìƒ ì‚¬ìš© */
        .is-reserved-personal { 
            background-color: #A3BFFA; /* ê°œì¸ ì—°ìŠµ - ì—°í•œ íŒŒë€ìƒ‰ ë°°ê²½ */
            color: #1E3A8A; /* ì§„í•œ íŒŒë€ìƒ‰ ê¸€ì */
        }
        .is-reserved-performance { 
            background-color: #FBBF24; /* ê³µì—° ì—°ìŠµ - ì—°í•œ ë…¸ë€ìƒ‰ ë°°ê²½ */
            color: #78350F; /* ì§„í•œ ê°ˆìƒ‰ ê¸€ì */
        }
        .is-reserved-lesson { 
            background-color: #A7F3D0; /* ê¸°íƒ€ ê°•ìŠµ - ì—°í•œ ì´ˆë¡ìƒ‰ ë°°ê²½ */
            color: #065F46; /* ì§„í•œ ì´ˆë¡ìƒ‰ ê¸€ì */
        }
        .is-reserved-meeting { 
            background-color: #DDD6FE; /* ì§‘ë¶€ íšŒì˜ - ì—°í•œ ë³´ë¼ìƒ‰ ë°°ê²½ */
            color: #5B21B6; /* ì§„í•œ ë³´ë¼ìƒ‰ ê¸€ì */
        }
        .is-reserved-other { 
            background-color: #D1D5DB; /* ê¸°íƒ€ - ì—°í•œ íšŒìƒ‰ ë°°ê²½ */
            color: #1F2937; /* ì§„í•œ íšŒìƒ‰ ê¸€ì */
        }
        
        /* ì‹œê°„ ìŠ¬ë¡¯ í˜¸ë²„ íš¨ê³¼ - ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¸ì„ ë•Œ ìƒ‰ìƒ ë³€ê²½ */
        .time-slot:hover { 
            background-color: #E0E7FF; /* ì—°í•œ íŒŒë€ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
        }
        
        /* ì§€ë‚œ ì‹œê°„ ìŠ¬ë¡¯ ìŠ¤íƒ€ì¼ - ì˜ˆì•½ ë¶ˆê°€ëŠ¥í•œ ê³¼ê±° ì‹œê°„ */
        .past-time { 
            background-color: #f3f4f6; /* ì—°í•œ íšŒìƒ‰ ë°°ê²½ */
            color: #9ca3af; /* íšŒìƒ‰ ê¸€ì */
            cursor: not-allowed; /* ê¸ˆì§€ ì»¤ì„œ í‘œì‹œ */
        }
        
        /* ëª¨ë‹¬(íŒì—…ì°½) ìŠ¤íƒ€ì¼ ì„¤ì • */
        .modal-backdrop {
            position: fixed; /* í™”ë©´ì— ê³ ì • ìœ„ì¹˜ */
            top: 0; /* í™”ë©´ ë§¨ ìœ„ì—ì„œ ì‹œì‘ */
            left: 0; /* í™”ë©´ ë§¨ ì™¼ìª½ì—ì„œ ì‹œì‘ */
            width: 100%; /* í™”ë©´ ì „ì²´ ë„ˆë¹„ */
            height: 100%; /* í™”ë©´ ì „ì²´ ë†’ì´ */
            background-color: rgba(0, 0, 0, 0.5); /* ë°˜íˆ¬ëª… ê²€ì€ìƒ‰ ë°°ê²½ */
            z-index: 40; /* ë‹¤ë¥¸ ìš”ì†Œë“¤ë³´ë‹¤ ìœ„ì— í‘œì‹œ */
        }
        
        .modal {
            z-index: 50; /* ë°°ê²½ë³´ë‹¤ ìœ„ì— í‘œì‹œ */
            max-width: 90%; /* ìµœëŒ€ ë„ˆë¹„ í™”ë©´ì˜ 90% */
            margin: 0 auto; /* í™”ë©´ ì¤‘ì•™ì— ë°°ì¹˜ */
        }
        
        /* ë‹¬ë ¥ ë‚ ì§œ ìŠ¤íƒ€ì¼ ì„¤ì • */
        .calendar-day.today .day-number { 
            background-color: #3B82F6; /* ì˜¤ëŠ˜ ë‚ ì§œ - íŒŒë€ìƒ‰ ë°°ê²½ */
            color: white; /* í°ìƒ‰ ê¸€ì */
            border-radius: 50%; /* ì›í˜• ëª¨ì–‘ */
            font-weight: 700; /* êµµì€ ê¸€ì”¨ */
        }
        
        .calendar-day.selected .day-number { 
            background-color: #1D4ED8; /* ì„ íƒëœ ë‚ ì§œ - ì§„í•œ íŒŒë€ìƒ‰ ë°°ê²½ */
            color: white; /* í°ìƒ‰ ê¸€ì */
            border-radius: 50%; /* ì›í˜• ëª¨ì–‘ */
            font-weight: 700; /* êµµì€ ê¸€ì”¨ */
        }
        
        .calendar-day.reservable-both { 
            background-color: #E9D5FF; /* ì˜ˆì•½ ê°€ëŠ¥í•œ ë‚ ì§œ (ë‘˜ ë‹¤) - ì—°í•œ ë³´ë¼ìƒ‰ ë°°ê²½ */
            border: 2px solid #A855F7; /* ë³´ë¼ìƒ‰ í…Œë‘ë¦¬ */
        }
        
        .calendar-day.reservable-performance { 
            background-color: #FEF3C7; /* ì˜ˆì•½ ê°€ëŠ¥í•œ ë‚ ì§œ (ê³µì—°ë§Œ) - ì—°í•œ ë…¸ë€ìƒ‰ ë°°ê²½ */
            border: 2px solid #F59E0B; /* ë…¸ë€ìƒ‰ í…Œë‘ë¦¬ */
        }
        
        .calendar-day.text-gray-400 {
            background-color: #F3F4F6; /* ë¹„í™œì„± ë‚ ì§œ - ì—°í•œ íšŒìƒ‰ ë°°ê²½ */
            color: #9CA3AF; /* íšŒìƒ‰ ê¸€ì */
        }
        
        /* í† ê¸€ ìŠ¤ìœ„ì¹˜ */
        .can-reserve-toggle:checked ~ .block { background-color: #3B82F6; }
        .can-reserve-toggle:checked ~ .dot { transform: translateX(1.5rem); }
        .lesson-instructor-toggle:checked ~ .block { background-color: #10B981; }
        .lesson-instructor-toggle:checked ~ .dot { transform: translateX(1.5rem); }
        
        /* ëª¨ë°”ì¼ í—¤ë” ìµœì í™” */
        .mobile-header {
            padding: 12px 16px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* ëª¨ë°”ì¼ ë²„íŠ¼ ê·¸ë£¹ */
        .mobile-button-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .mobile-button {
            flex: 1;
            min-width: 80px;
            padding: 12px 8px;
            font-size: 14px;
            border-radius: 8px;
            border: none;
            font-weight: 500;
        }
        
        /* ëª¨ë°”ì¼ í¼ ìµœì í™” */
        .mobile-form {
            padding: 20px 16px;
        }
        
        .mobile-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 16px;
        }
        
        /* ë‹¬ë ¥ ëª¨ë°”ì¼ ìµœì í™” */
        .mobile-calendar {
            padding: 16px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            width: 100%;
            padding: 6px;
            background: #f8f9fa;
            border-radius: 12px;
            max-width: 100%;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            min-height: 36px;
            max-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s ease;
            width: 100%;
            background: white;
            border: 1px solid #e5e7eb;
        }
        
        .calendar-day.empty {
            visibility: hidden;
            background: transparent;
            border: none;
        }
        
        .calendar-day:hover:not(.empty) {
            background: #f3f4f6;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .calendar-day .day-number {
            padding: 4px 8px;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        /* ì‹œê°„ ê·¸ë¦¬ë“œ ëª¨ë°”ì¼ ìµœì í™” */
        .time-slot {
            padding: 16px;
            border-bottom: 1px solid #e5e7eb;
            min-height: 60px;
            display: flex;
            align-items: center;
        }
        
        .time-label {
            width: 60px;
            font-size: 14px;
            font-weight: 500;
            color: #6b7280;
        }
        
        .time-info {
            flex: 1;
            font-size: 14px;
            margin-left: 16px;
        }
    </style>
</head>
<body class="bg-[#F8F7F4] text-gray-800">
    <!-- 
    ===========================================
    HTML ë³¸ë¬¸ ì‹œì‘ - ì‹¤ì œ ì›¹í˜ì´ì§€ ë‚´ìš©
    ===========================================
    
    ì—¬ê¸°ì„œë¶€í„°ëŠ” ì‹¤ì œë¡œ ì‚¬ìš©ìê°€ ë³´ê²Œ ë  ì›¹í˜ì´ì§€ì˜ ë‚´ìš©ì…ë‹ˆë‹¤.
    ê° ì„¹ì…˜ì€ íŠ¹ì • ê¸°ëŠ¥ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.
    -->

    <!-- ë©”ì¸ ì•± ì»¨í…Œì´ë„ˆ - ëª¨ë“  ë‚´ìš©ì´ ë“¤ì–´ê°ˆ ìµœìƒìœ„ ì˜ì—­ -->
    <div id="app-container">
        
        <!-- ë¡œë”© í™”ë©´ - ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë™ì•ˆ í‘œì‹œë˜ëŠ” í™”ë©´ -->
        <div id="loading-overlay" class="fixed inset-0 bg-white/70 z-50 flex items-center justify-center backdrop-blur-sm">
            <div id="loading-indicator" class="text-center">
                <!-- íšŒì „í•˜ëŠ” ë¡œë”© ì•„ì´ì½˜ -->
                <svg class="animate-spin h-8 w-8 text-slate-700 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="mt-2 text-slate-600">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
        </div>

        <!-- ë¡œê·¸ì¸/íšŒì›ê°€ì… í™”ë©´ - ì²˜ìŒ ì ‘ì†í–ˆì„ ë•Œ ë³´ì´ëŠ” í™”ë©´ -->
        <div id="auth-view" class="hidden">
            <div class="min-h-screen flex items-center justify-center bg-gray-100">
                <div class="w-full max-w-sm p-6 space-y-6 bg-white rounded-lg shadow-lg">
                    <!-- ë¡œê·¸ì¸ í¼ ì˜ì—­ -->
                    <div id="login-form-container">
                        <h2 class="text-2xl font-bold text-center">ë™ì•„ë¦¬ë°© ì˜ˆì•½ ì‹œìŠ¤í…œ ë¡œê·¸ì¸</h2>
                        <form id="login-form" class="mt-6 space-y-4">
                            <div class="space-y-3">
                                <!-- í•™ë²ˆ ë˜ëŠ” ì´ë©”ì¼ ì…ë ¥ í•„ë“œ -->
                                <input id="login-student-id" name="student-id" type="text" autocomplete="username" required class="mobile-input" placeholder="í•™ë²ˆ ë˜ëŠ” ì´ë©”ì¼">
                                <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í•„ë“œ -->
                                <input id="login-password" name="password" type="password" autocomplete="current-password" required class="mobile-input" placeholder="ë¹„ë°€ë²ˆí˜¸">
                            </div>
                            <!-- ë¡œê·¸ì¸ ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ -->
                            <p id="login-error" class="text-red-500 text-sm hidden"></p>
                            <!-- ë¡œê·¸ì¸ ë²„íŠ¼ -->
                            <button type="submit" class="w-full mobile-button bg-[#4A5568] text-white">ë¡œê·¸ì¸</button>
                        </form>
                         <div class="text-center mt-6 space-y-2">
                            <p class="text-sm text-gray-600">
                                ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? 
                                <!-- íšŒì›ê°€ì… í™”ë©´ìœ¼ë¡œ ì „í™˜í•˜ëŠ” ë²„íŠ¼ -->
                                <button id="show-register-btn" class="font-medium text-indigo-600 hover:text-indigo-500">íšŒì›ê°€ì…</button>
                            </p>
                            <p class="text-sm text-gray-600">
                                ë¹„ë°€ë²ˆí˜¸ ë¶„ì‹¤ ì‹œ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.
                            </p>
                        </div>
                    </div>

                    <!-- íšŒì›ê°€ì… í¼ ì˜ì—­ (ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê²¨ì ¸ ìˆìŒ) -->
                    <div id="register-form-container" class="hidden">
                         <h2 class="text-xl font-bold text-center">íšŒì›ê°€ì…</h2>
                        <form id="register-form" class="mt-6 space-y-4">
                             <!-- ì´ë¦„ ì…ë ¥ í•„ë“œ -->
                             <input id="register-name" type="text" required class="mobile-input" placeholder="ì´ë¦„">
                            <!-- í•™ë²ˆ ì…ë ¥ í•„ë“œ -->
                            <input id="register-student-id" type="text" required class="mobile-input" placeholder="í•™ë²ˆ (ì˜ˆ: 202212026)">
                             <!-- ì´ë©”ì¼ ì…ë ¥ í•„ë“œ -->
                             <input id="register-email" type="email" autocomplete="email" required class="mobile-input" placeholder="ì´ë©”ì¼ ì£¼ì†Œ (ë¡œê·¸ì¸ ID)">
                            <!-- íšŒì›ê°€ì… ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ -->
                            <p id="register-error" class="text-red-500 text-sm hidden"></p>
                            <!-- ì „í™”ë²ˆí˜¸ ì…ë ¥ í•„ë“œ -->
                            <input id="register-phone" type="tel" required class="mobile-input" placeholder="ì „í™”ë²ˆí˜¸">
                            <div>
                                <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í•„ë“œ -->
                                <input id="register-password" type="password" autocomplete="new-password" required class="mobile-input" placeholder="ë¹„ë°€ë²ˆí˜¸ (6ìë¦¬ ì´ìƒ)">
                                <p class="text-xs text-gray-500 mt-1">â€» ë¹„ë°€ë²ˆí˜¸ëŠ” ê´€ë¦¬ìê°€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                            </div>
                            
                            <!-- íšŒì›ê°€ì… ë²„íŠ¼ -->
                            <button type="submit" class="w-full mobile-button bg-[#4A5568] text-white">ê°€ì…í•˜ê¸°</button>
                        </form>
                        <p class="mt-4 text-center text-sm text-gray-600">ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? 
                            <!-- ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ëŠ” ë²„íŠ¼ -->
                            <button id="show-login-btn" class="font-medium text-indigo-600 hover:text-indigo-500">ë¡œê·¸ì¸</button>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë©”ì¸ ì•± í™”ë©´ - ë¡œê·¸ì¸ í›„ ë³´ì´ëŠ” ë©”ì¸ í™”ë©´ -->
        <div id="main-view" class="hidden">
             <!-- ìƒë‹¨ í—¤ë” ì˜ì—­ -->
             <header class="mobile-header">
                <div class="flex justify-between items-center mb-3">
                    <!-- ì•± ì œëª© -->
                    <h1 class="text-lg font-bold">ë™ì•„ë¦¬ë°© ì˜ˆì•½ ì‹œìŠ¤í…œ</h1>
                    <!-- ì‚¬ìš©ì ë‹‰ë„¤ì„ í‘œì‹œ -->
                    <span id="user-nickname" class="text-sm font-medium text-gray-600"></span>
                </div>
                <!-- ìƒë‹¨ ë²„íŠ¼ ê·¸ë£¹ -->
                <div class="mobile-button-group">
                    <!-- ë‚´ ì˜ˆì•½ ë³´ê¸° ë²„íŠ¼ -->
                    <button id="my-reservations-btn" class="mobile-button bg-green-500 text-white">ë‚´ ì˜ˆì•½</button>
                    <!-- ë‚´ ì •ë³´ ìˆ˜ì • ë²„íŠ¼ -->
                    <button id="edit-profile-btn" class="mobile-button bg-slate-200 text-slate-800">ë‚´ ì •ë³´</button>
                    <!-- ê´€ë¦¬ì íŒ¨ë„ ë²„íŠ¼ (ê´€ë¦¬ìë§Œ ë³´ì„) -->
                    <button id="admin-panel-btn" class="mobile-button bg-yellow-500 text-white hidden">ê´€ë¦¬ì</button>
                    <!-- ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
                    <button id="logout-btn" class="mobile-button bg-red-500 text-white">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </header>
            
            <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ -->
            <main class="mobile-calendar">
                <!-- ì›”ê°„ ë‹¬ë ¥ ë·° -->
                <div id="monthly-view">
                    <div class="bg-white rounded-lg shadow-lg p-4">
                        <!-- ë‹¬ë ¥ì´ í‘œì‹œë  ì˜ì—­ -->
                        <div id="main-calendar-container"></div>
                    </div>
                    
                    <!-- ê³µì§€ì‚¬í•­ í‘œì‹œ ì˜ì—­ -->
                    <div class="bg-white rounded-lg shadow-lg p-4 mt-4">
                        <h3 class="text-lg font-bold mb-4">ğŸ“¢ ê³µì§€ì‚¬í•­</h3>
                        
                        <!-- ê´€ë¦¬ììš© ê³µì§€ì‚¬í•­ ì¶”ê°€ ì˜ì—­ (ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê²¨ì ¸ ìˆìŒ) -->
                        <div id="notice-add-section" class="hidden mb-4 p-3 bg-gray-50 rounded-lg">
                            <h4 class="text-sm font-semibold text-gray-700 mb-2">ìƒˆ ê³µì§€ì‚¬í•­ ì¶”ê°€</h4>
                            <!-- ê³µì§€ì‚¬í•­ ë‚´ìš© ì…ë ¥ í•„ë“œ -->
                            <textarea id="notice-text" class="w-full mobile-input h-20 resize-none mb-2" placeholder="ê³µì§€ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                            <div class="flex gap-2">
                                <!-- ê³µì§€ì‚¬í•­ ì €ì¥ ë²„íŠ¼ -->
                                <button id="save-notice-btn" class="mobile-button bg-blue-500 text-white flex-1">ê³µì§€ì‚¬í•­ ì¶”ê°€</button>
                                <!-- ê³µì§€ì‚¬í•­ ì¶”ê°€ ì·¨ì†Œ ë²„íŠ¼ -->
                                <button id="cancel-notice-btn" class="mobile-button bg-gray-500 text-white flex-1">ì·¨ì†Œ</button>
                            </div>
                        </div>
                        
                        <!-- ê³µì§€ì‚¬í•­ ì¶”ê°€ ë²„íŠ¼ (ê´€ë¦¬ìë§Œ í‘œì‹œ) -->
                        <div id="notice-add-button-container" class="hidden mb-4">
                            <button id="show-notice-add-btn" class="mobile-button bg-blue-500 text-white w-full">ğŸ“ ê³µì§€ì‚¬í•­ ì¶”ê°€</button>
                        </div>
                        
                        <!-- ê³µì§€ì‚¬í•­ ëª©ë¡ì´ í‘œì‹œë  ì˜ì—­ -->
                        <div id="notices-list-container">
                            <div class="text-center text-gray-500 py-4">
                                ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ì¼ê°„ ë·° - íŠ¹ì • ë‚ ì§œì˜ ì‹œê°„ë³„ ì˜ˆì•½ í˜„í™©ì„ ë³´ëŠ” í™”ë©´ -->
                <div id="daily-view" class="hidden">
                    <div class="bg-white rounded-lg shadow-lg p-4">
                        <div class="mb-4">
                            <div class="flex justify-between items-center mb-3">
                                <!-- ë‹¬ë ¥ìœ¼ë¡œ ëŒì•„ê°€ëŠ” ë²„íŠ¼ -->
                                <button id="back-to-calendar-btn" class="px-3 py-2 bg-gray-200 text-gray-800 rounded-lg text-sm font-medium hover:bg-gray-300 transition-colors">&larr; ë‹¬ë ¥</button>
                                <div class="flex items-center gap-4">
                                    <!-- ì´ì „ ë‚ ì§œë¡œ ì´ë™í•˜ëŠ” ë²„íŠ¼ -->
                                    <button id="prev-day-btn" class="w-10 h-10 bg-gray-200 text-gray-800 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors">
                                        <span class="text-lg font-bold">â†</span>
                                    </button>
                                    <!-- ë‹¤ìŒ ë‚ ì§œë¡œ ì´ë™í•˜ëŠ” ë²„íŠ¼ -->
                                    <button id="next-day-btn" class="w-10 h-10 bg-gray-200 text-gray-800 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors">
                                        <span class="text-lg font-bold">â†’</span>
                                    </button>
                                </div>
                            </div>
                            <div class="text-center">
                                <!-- í˜„ì¬ ë³´ê³  ìˆëŠ” ë‚ ì§œ í‘œì‹œ -->
                                <h2 id="daily-view-date" class="text-xl font-bold text-gray-800"></h2>
                            </div>
                        </div>
                        <!-- ì˜ˆì•½ ëª©ì ë³„ ìƒ‰ìƒ ë²”ë¡€ -->
                        <div id="daily-legend" class="text-center mb-4 p-3 bg-gray-50 rounded-lg flex flex-wrap items-center justify-center gap-x-4 gap-y-2 text-xs text-gray-700">
                        </div>
                        <!-- ì‹œê°„ë³„ ì˜ˆì•½ ìŠ¬ë¡¯ì´ í‘œì‹œë  ì˜ì—­ -->
                        <div id="time-grid-container" class="border rounded-lg overflow-hidden">
                        </div>
                    </div>
                </div>

                <!-- ë‚´ ì˜ˆì•½ ëª©ë¡ ë·° - ì‚¬ìš©ìê°€ ì˜ˆì•½í•œ ëª¨ë“  ì˜ˆì•½ì„ ë³´ëŠ” í™”ë©´ -->
                <div id="my-reservations-view" class="hidden">
                    <div class="bg-white rounded-lg shadow-lg p-4">
                         <div class="flex justify-between items-center mb-4">
                            <!-- ë‹¬ë ¥ìœ¼ë¡œ ëŒì•„ê°€ëŠ” ë²„íŠ¼ -->
                            <button id="back-to-calendar-from-my-reservations-btn" class="mobile-button bg-gray-200 text-gray-800">&larr; ë‹¬ë ¥</button>
                            <!-- í™”ë©´ ì œëª© -->
                            <h2 class="text-lg font-bold text-center flex-1">ë‚´ ì˜ˆì•½ ëª©ë¡</h2>
                        </div>
                        <!-- ë‚´ ì˜ˆì•½ ëª©ë¡ì´ í‘œì‹œë  ì˜ì—­ -->
                        <div id="my-reservations-list-container" class="overflow-x-auto"></div>
                    </div>
                </div>

            </main>
        </div>
        
        <!-- ê´€ë¦¬ì íŒ¨ë„ í™”ë©´ - ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥í•œ í™”ë©´ -->
        <div id="admin-view" class="hidden">
            <header class="mobile-header">
                <div class="flex justify-between items-center">
                    <!-- ê´€ë¦¬ì íŒ¨ë„ ì œëª© -->
                    <h1 class="text-lg font-bold">ê´€ë¦¬ì íŒ¨ë„</h1>
                    <!-- ë©”ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ëŠ” ë²„íŠ¼ -->
                    <button id="back-to-main-btn" class="mobile-button bg-blue-500 text-white">ëŒì•„ê°€ê¸°</button>
                </div>
            </header>
            <main class="mobile-calendar">
                <div class="bg-white rounded-lg shadow-lg p-4">
                    <!-- íšŒì› ê´€ë¦¬ ì„¹ì…˜ ì œëª© -->
                    <h2 class="text-lg font-bold mb-4">íšŒì› ê´€ë¦¬</h2>
                    <!-- íšŒì› ê´€ë¦¬ í…Œì´ë¸”ì´ í‘œì‹œë  ì˜ì—­ -->
                    <div id="user-management-tables-container" class="space-y-6"></div>
                </div>
            </main>
        </div>
    </div>

    <!-- ëª¨ë‹¬(íŒì—…ì°½) ì˜ì—­ë“¤ -->
    <!-- ì˜ˆì•½ ê´€ë ¨ ëª¨ë‹¬ - ì˜ˆì•½ ì •ë³´ ë³´ê¸°/ìˆ˜ì •/ì·¨ì†Œ -->
    <div id="reservation-modal" class="modal-backdrop hidden flex items-center justify-center">
        <div class="modal bg-white rounded-lg shadow-xl w-11/12 md:max-w-md mx-auto p-6">
            <!-- ëª¨ë‹¬ ì œëª© -->
            <h3 id="modal-title" class="text-xl font-bold mb-4">ì˜ˆì•½ ì •ë³´</h3>
            
            <!-- ì˜ˆì•½ ì •ë³´ ë³´ê¸° ì˜ì—­ -->
            <div id="modal-view-content">
                 <!-- ì˜ˆì•½ì ì •ë³´ -->
                 <p><strong>ì˜ˆì•½ì:</strong> <span id="view-booker"></span></p>
                 <!-- ì˜ˆì•½ ì‹œê°„ -->
                 <p><strong>ì‹œê°„:</strong> <span id="view-time"></span></p>
                 <!-- ì˜ˆì•½ ëª©ì  -->
                 <p><strong>ëª©ì :</strong> <span id="view-purpose"></span></p>
                 <!-- ê³µì—°ëª… (ê³µì—° ì—°ìŠµì¼ ë•Œë§Œ í‘œì‹œ) -->
                 <p id="view-performance-name-container"><strong>ê³µì—°ëª…:</strong> <span id="view-performance-name"></span></p>
                 <!-- ì°¸ì—¬ì ìˆ˜ -->
                 <p><strong>ì°¸ì—¬ì:</strong> <span id="view-participants"></span></p>
                 
                 <!-- ëª¨ë‹¬ ë²„íŠ¼ë“¤ -->
                 <div id="view-modal-buttons" class="mt-6 flex justify-end space-x-3">
                     <!-- ì˜ˆì•½ ìˆ˜ì • ë²„íŠ¼ -->
                     <button id="edit-reservation-btn" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">ìˆ˜ì •</button>
                     <!-- ì˜ˆì•½ ì·¨ì†Œ ë²„íŠ¼ -->
                     <button id="cancel-reservation-btn" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">ì˜ˆì•½ ì·¨ì†Œ</button>
                     <!-- ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼ -->
                     <button id="close-view-modal-btn" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">ë‹«ê¸°</button>
                 </div>
                 
                 <!-- ì˜ˆì•½ ì·¨ì†Œ í™•ì¸ ì˜ì—­ (ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê²¨ì ¸ ìˆìŒ) -->
                 <div id="cancel-confirm-container" class="hidden mt-4 bg-red-50 p-4 rounded-md text-center">
                    <p class="text-red-800 font-semibold">ì •ë§ ì˜ˆì•½ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                    <div class="mt-4 flex justify-center space-x-4">
                        <!-- ì˜ˆì•½ ì·¨ì†Œ í™•ì¸ ë²„íŠ¼ -->
                        <button id="confirm-cancel-btn" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 w-24">ì˜ˆ</button>
                        <!-- ì˜ˆì•½ ì·¨ì†Œ ì·¨ì†Œ ë²„íŠ¼ -->
                        <button id="abort-cancel-btn" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400 w-24">ì•„ë‹ˆì˜¤</button>
                    </div>
                 </div>
            </div>
            <!-- ì˜ˆì•½ ìˆ˜ì •/ì¶”ê°€ í¼ ì˜ì—­ (ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê²¨ì ¸ ìˆìŒ) -->
            <form id="modal-form-content" class="space-y-4 hidden">
                <!-- ìˆ¨ê²¨ì§„ í•„ë“œë“¤ - JavaScriptì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°ì´í„° -->
                <input type="hidden" id="reservation-start-time">
                <input type="hidden" id="edit-reservation-id">
                
                <!-- ì˜ˆì•½ ëª©ì  ì„ íƒ -->
                <div>
                    <label for="reservation-purpose" class="block text-sm font-medium text-gray-700">ëª©ì </label>
                    <select id="reservation-purpose" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    </select>
                </div>
                 <!-- ì˜ˆì•½ ì‹œê°„ ì„ íƒ -->
                 <div>
                    <label for="reservation-duration" class="block text-sm font-medium text-gray-700">ì˜ˆì•½ ì‹œê°„</label>
                    <select id="reservation-duration" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    </select>
                </div>
                
                <!-- ê³µì—°ëª… ì…ë ¥ í•„ë“œ (ê³µì—° ì—°ìŠµ ì„ íƒ ì‹œì—ë§Œ í‘œì‹œ) -->
                <div id="performance-name-wrapper" class="hidden">
                    <label for="performance-name" class="block text-sm font-medium text-gray-700">ê³µì—°ëª…</label>
                    <input type="text" id="performance-name" class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                </div>
                
                <!-- ì°¸ì—¬ì ì…ë ¥ í•„ë“œ -->
                <div>
                     <label for="participants" class="block text-sm font-medium text-gray-700">ì°¸ì—¬ì ë³„ëª…</label>
                     <input type="text" id="participants" class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" placeholder="ì§ì ‘ ì…ë ¥í•˜ê±°ë‚˜ ì•„ë˜ì—ì„œ ê²€ìƒ‰/ì„ íƒí•˜ì„¸ìš”">
                     <!-- ì°¸ì—¬ì ìë™ì™„ì„± ëª©ë¡ -->
                     <div id="participant-suggestion-list" class="flex flex-wrap gap-2 mt-2 max-h-24 overflow-y-auto p-2 border rounded-md bg-gray-50"></div>
                </div>
                
                <!-- ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ -->
                <p id="modal-error" class="text-red-500 text-sm hidden"></p>
                
                <!-- í¼ ë²„íŠ¼ë“¤ -->
                <div class="flex justify-end space-x-3">
                    <!-- ì·¨ì†Œ ë²„íŠ¼ -->
                    <button type="button" id="close-form-modal-btn" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">ì·¨ì†Œ</button>
                    <!-- ì €ì¥ ë²„íŠ¼ -->
                    <button type="submit" id="save-reservation-btn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- íšŒì› ì •ë³´ ìˆ˜ì • ëª¨ë‹¬ - ê´€ë¦¬ìê°€ íšŒì› ì •ë³´ë¥¼ ìˆ˜ì •í•  ë•Œ ì‚¬ìš© -->
    <div id="edit-user-modal" class="modal-backdrop hidden flex items-center justify-center">
        <div class="modal bg-white rounded-lg shadow-xl w-11/12 md:max-w-md mx-auto p-6">
            <!-- ëª¨ë‹¬ ì œëª© -->
            <h3 class="text-xl font-bold mb-4">íšŒì› ì •ë³´ ìˆ˜ì •</h3>
            
            <!-- íšŒì› ì •ë³´ ìˆ˜ì • í¼ -->
            <form id="edit-user-form" class="space-y-4">
                <!-- ìˆ¨ê²¨ì§„ í•„ë“œ - ìˆ˜ì •í•  íšŒì›ì˜ ID -->
                <input type="hidden" id="edit-user-id">
                
                <!-- ì´ë¦„ ì…ë ¥ í•„ë“œ -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">ì´ë¦„</label>
                    <input type="text" id="edit-user-name" class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                </div>
                
                <!-- í•™ë²ˆ ì…ë ¥ í•„ë“œ -->
                 <div>
                    <label class="block text-sm font-medium text-gray-700">í•™ë²ˆ</label>
                    <input type="text" id="edit-user-student-id" class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                </div>
                
                <!-- ì „í™”ë²ˆí˜¸ ì…ë ¥ í•„ë“œ -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">ì „í™”ë²ˆí˜¸</label>
                    <input type="tel" id="edit-user-phone" class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                </div>
                
                <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í•„ë“œ (ì„ íƒì‚¬í•­) -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">ë¹„ë°€ë²ˆí˜¸ (ë³€ê²½ ì‹œ ì…ë ¥)</label>
                    <input type="password" id="edit-user-password" class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" placeholder="ë³€ê²½í•˜ì§€ ì•Šìœ¼ë ¤ë©´ ë¹„ì›Œë‘ì„¸ìš”">
                </div>
                 <div class="flex justify-end space-x-3">
                    <button type="button" id="close-edit-modal-btn" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">ì·¨ì†Œ</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <div id="edit-profile-modal" class="modal-backdrop hidden flex items-center justify-center">
        <div class="modal bg-white rounded-lg shadow-xl w-11/12 md:max-w-md mx-auto p-6">
            <h3 class="text-xl font-bold mb-4">ë‚´ ì •ë³´ ìˆ˜ì •</h3>
            <form id="edit-profile-form" class="space-y-4">
                 <div>
                    <label for="edit-profile-name" class="block text-sm font-medium text-gray-700">ì´ë¦„</label>
                    <input type="text" id="edit-profile-name" required class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                </div>
                 <div>
                    <label for="edit-profile-student-id" class="block text-sm font-medium text-gray-700">í•™ë²ˆ</label>
                    <input type="text" id="edit-profile-student-id" required class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                </div>
                <div>
                    <label for="edit-profile-phone" class="block text-sm font-medium text-gray-700">ì „í™”ë²ˆí˜¸</label>
                    <input type="tel" id="edit-profile-phone" required class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                </div>
                 <div>
                    <label class="block text-sm font-medium text-gray-700">ì´ë©”ì¼ (ë³€ê²½ ë¶ˆê°€)</label>
                    <p id="current-email-display" class="mt-1 block w-full shadow-sm sm:text-sm border-gray-200 rounded-md bg-gray-100 p-2 text-gray-500"></p>
                </div>
                 <div>
                    <label for="edit-profile-password" class="block text-sm font-medium text-gray-700">ìƒˆ ë¹„ë°€ë²ˆí˜¸ (ë³€ê²½ ì‹œ ì…ë ¥)</label>
                    <input type="password" id="edit-profile-password" class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" placeholder="ë³€ê²½í•˜ì§€ ì•Šìœ¼ë ¤ë©´ ë¹„ì›Œë‘ì„¸ìš”">
                </div>
                <p id="edit-profile-error" class="text-red-500 text-sm hidden"></p>
                 <div class="flex justify-end space-x-3">
                    <button type="button" id="close-edit-profile-modal-btn" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">ì·¨ì†Œ</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="confirmation-modal" class="modal-backdrop hidden flex items-center justify-center">
        <div class="modal bg-white rounded-lg shadow-xl w-11/12 md:max-w-sm mx-auto p-6 text-center">
            <h3 id="confirmation-title" class="text-lg font-bold mb-4">í™•ì¸</h3>
            <p id="confirmation-message" class="mb-6"></p>
            <div class="flex justify-center space-x-4">
                <button id="confirm-yes-btn" class="px-6 py-2 bg-red-600 text-white rounded hover:bg-red-700">ì˜ˆ</button>
                <button id="confirm-no-btn" class="px-6 py-2 bg-gray-300 rounded hover:bg-gray-400">ì•„ë‹ˆì˜¤</button>
            </div>
        </div>
    </div>

    <!-- 
    ===========================================
    JavaScript ì½”ë“œ ì‹œì‘ - ì‹¤ì œ ê¸°ëŠ¥ì„ ë™ì‘ì‹œí‚¤ëŠ” í”„ë¡œê·¸ë˜ë° ì½”ë“œ
    ===========================================
    
    JavaScriptëŠ” ì›¹í˜ì´ì§€ì˜ ëª¨ë“  ê¸°ëŠ¥ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.
    ì—¬ê¸°ì„œ ë¡œê·¸ì¸, ì˜ˆì•½, ë°ì´í„° ì €ì¥ ë“±ì˜ ëª¨ë“  ê¸°ëŠ¥ì´ êµ¬í˜„ë©ë‹ˆë‹¤.
    
    ì£¼ìš” ê¸°ëŠ¥:
    1. Firebase ì—°ê²° - ë°ì´í„°ë² ì´ìŠ¤ì™€ ì¸ì¦ ê´€ë¦¬
    2. ì‚¬ìš©ì ê´€ë¦¬ - ë¡œê·¸ì¸, íšŒì›ê°€ì…, ê¶Œí•œ ê´€ë¦¬
    3. ì˜ˆì•½ ì‹œìŠ¤í…œ - ì˜ˆì•½ ìƒì„±, ìˆ˜ì •, ì·¨ì†Œ
    4. ë‹¬ë ¥ í‘œì‹œ - ì›”ê°„/ì¼ê°„ ë‹¬ë ¥ ë Œë”ë§
    5. ê´€ë¦¬ì ê¸°ëŠ¥ - íšŒì› ê´€ë¦¬, ê³µì§€ì‚¬í•­ ê´€ë¦¬
    
    ìˆ˜ì • ë°©ë²•:
    - í…ìŠ¤íŠ¸ ë³€ê²½: ë¬¸ìì—´ ê°’ ìˆ˜ì •
    - ê¸°ëŠ¥ ì¶”ê°€: ìƒˆë¡œìš´ í•¨ìˆ˜ ì‘ì„±
    - ìƒ‰ìƒ ë³€ê²½: CSS í´ë˜ìŠ¤ëª… ë³€ê²½
    - ì‹œê°„ ì„¤ì •: ì‹œê°„ ê´€ë ¨ ë³€ìˆ˜ ìˆ˜ì •
    -->
    <script type="module">
        /* 
        ===========================================
        Firebase ì„¤ì • - ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì •ë³´
        ===========================================
        
        FirebaseëŠ” Googleì—ì„œ ì œê³µí•˜ëŠ” í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.
        ì—¬ê¸°ì„œ ì‚¬ìš©ì ë°ì´í„°ì™€ ì˜ˆì•½ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.
        
        ìˆ˜ì • ë°©ë²•:
        1. Firebase ì½˜ì†”ì—ì„œ ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±
        2. ì›¹ ì•± ì¶”ê°€ í›„ ì„¤ì • ì •ë³´ ë³µì‚¬
        3. ì•„ë˜ ì„¤ì • ì •ë³´ë¥¼ ë³¸ì¸ì˜ Firebase ì„¤ì •ìœ¼ë¡œ êµì²´
        */
        
        // Firebase í”„ë¡œì íŠ¸ ì„¤ì • ì •ë³´ (ë³¸ì¸ì˜ Firebase ì„¤ì •ìœ¼ë¡œ êµì²´í•˜ì„¸ìš”)
        const firebaseConfig = {
          apiKey: "AIzaSyDv3wtFN8JS5oPTzc-q2MOY_AgREz6PayE", // API í‚¤
          authDomain: "siselpapi-booking.firebaseapp.com", // ì¸ì¦ ë„ë©”ì¸
          projectId: "siselpapi-booking", // í”„ë¡œì íŠ¸ ID
          storageBucket: "siselpapi-booking.appspot.com", // ìŠ¤í† ë¦¬ì§€ ë²„í‚·
          messagingSenderId: "600565586957", // ë©”ì‹œì§• ë°œì‹ ì ID
          appId: "1:600565586957:web:658874f3f3d8be74914944" // ì•± ID
        };
        
        // ì•± ê³ ìœ  ì‹ë³„ì (ì›í•˜ëŠ” ì´ë¦„ìœ¼ë¡œ ë³€ê²½ ê°€ëŠ¥)
        const appId = 'siselpapi-booking-app';


        // Firebase ë¼ì´ë¸ŒëŸ¬ë¦¬ import - í•„ìš”í•œ ê¸°ëŠ¥ë“¤ì„ ê°€ì ¸ì˜´
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"; // Firebase ì•± ì´ˆê¸°í™”
        import { 
            getAuth, // ì¸ì¦ ê°ì²´ ê°€ì ¸ì˜¤ê¸°
            onAuthStateChanged, // ë¡œê·¸ì¸ ìƒíƒœ ë³€í™” ê°ì§€
            createUserWithEmailAndPassword, // ì´ë©”ì¼ë¡œ íšŒì›ê°€ì…
            signInWithEmailAndPassword, // ì´ë©”ì¼ë¡œ ë¡œê·¸ì¸
            signOut, // ë¡œê·¸ì•„ì›ƒ
            updatePassword // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"; // Firebase ì¸ì¦ ê¸°ëŠ¥
        import { 
            getFirestore, // Firestore ë°ì´í„°ë² ì´ìŠ¤ ê°ì²´
            doc, // ë¬¸ì„œ ì°¸ì¡°
            getDoc, // ë¬¸ì„œ ì½ê¸°
            setDoc, // ë¬¸ì„œ ì„¤ì •
            addDoc, // ë¬¸ì„œ ì¶”ê°€
            updateDoc, // ë¬¸ì„œ ì—…ë°ì´íŠ¸
            deleteDoc, // ë¬¸ì„œ ì‚­ì œ
            onSnapshot, // ì‹¤ì‹œê°„ ë°ì´í„° ê°ì§€
            collection, // ì»¬ë ‰ì…˜ ì°¸ì¡°
            query, // ì¿¼ë¦¬ ìƒì„±
            where, // ì¡°ê±´ ì„¤ì •
            getDocs, // ì—¬ëŸ¬ ë¬¸ì„œ ì½ê¸°
            writeBatch, // ë°°ì¹˜ ì‘ì—…
            Timestamp // ì‹œê°„ ìŠ¤íƒ¬í”„
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"; // Firebase ë°ì´í„°ë² ì´ìŠ¤ ê¸°ëŠ¥
        
        // ì „ì—­ ë³€ìˆ˜ë“¤ - ì•± ì „ì²´ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì¤‘ìš”í•œ ë³€ìˆ˜ë“¤
        let app, db, auth; // Firebase ê°ì²´ë“¤

        // --- Start of original script, adapted for Firebase ---

        // í˜ì´ì§€ê°€ ì™„ì „íˆ ë¡œë“œëœ í›„ ì‹¤í–‰ë˜ëŠ” ì½”ë“œ
        document.addEventListener('DOMContentLoaded', () => {
            /* 
            ===========================================
            ë°ì´í„° ë§¤í•‘ ì„¤ì • - ì½”ë“œì™€ í‘œì‹œ í…ìŠ¤íŠ¸ ì—°ê²°
            ===========================================
            
            ì´ ë¶€ë¶„ì—ì„œ ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©í•˜ëŠ” ì½”ë“œì™€ ì‚¬ìš©ìê°€ ë³´ëŠ” í…ìŠ¤íŠ¸ë¥¼ ì—°ê²°í•©ë‹ˆë‹¤.
            ì˜ˆë¥¼ ë“¤ì–´, '01' ì½”ë“œëŠ” 'ìœ¤ë¦¬' ê³¼ëª©ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
            
            ìˆ˜ì • ë°©ë²•:
            - ê³¼ëª© ì¶”ê°€: DEPT_MAPì— ìƒˆ ì½”ë“œì™€ ê³¼ëª©ëª… ì¶”ê°€
            - ì˜ˆì•½ ëª©ì  ì¶”ê°€: PURPOSE_MAPì— ìƒˆ ëª©ì  ì¶”ê°€
            - í…ìŠ¤íŠ¸ ë³€ê²½: í‘œì‹œë  í…ìŠ¤íŠ¸ ìˆ˜ì •
            */
            
            // í•™ê³¼ ì½”ë“œì™€ ê³¼ëª©ëª… ë§¤í•‘ (í•™ê³¼ ì¶”ê°€/ìˆ˜ì • ì‹œ ì—¬ê¸°ì„œ ë³€ê²½)
            const DEPT_MAP = {
                '01': 'ìœ¤ë¦¬', '02': 'êµ­ì–´', '03': 'ì‚¬íšŒê³¼', '04': 'ìˆ˜í•™',
                '05': 'ê³¼í•™', '06': 'ì²´ìœ¡', '07': 'ìŒì•…', '08': 'ë¯¸ìˆ ',
                '09': 'ì‹¤ê³¼', '10': 'êµìœ¡', '11': 'ì˜ì–´', '12': 'ì»´í“¨í„°', '13': 'íŠ¹ìˆ˜í†µí•©'
            };
            
            // ì˜ˆì•½ ëª©ì  ì½”ë“œì™€ ëª©ì ëª… ë§¤í•‘ (ì˜ˆì•½ ëª©ì  ì¶”ê°€/ìˆ˜ì • ì‹œ ì—¬ê¸°ì„œ ë³€ê²½)
            const PURPOSE_MAP = {
                'personal': 'ê°œì¸ ì—°ìŠµ',
                'performance': 'ê³µì—° ì—°ìŠµ',
                'lesson': 'ê¸°íƒ€ ê°•ìŠµ',
                'meeting': 'ì§‘ë¶€ íšŒì˜',
                'other': 'ê¸°íƒ€'
            };

            /* 
            ===========================================
            ì‹œê°„ ê´€ë ¨ í•¨ìˆ˜ë“¤ - í•œêµ­ ì‹œê°„ëŒ€ ì²˜ë¦¬
            ===========================================
            
            ì´ í•¨ìˆ˜ë“¤ì€ í•œêµ­ ì‹œê°„ëŒ€(UTC+9)ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ í•¨ìˆ˜ë“¤ì…ë‹ˆë‹¤.
            ì„œë²„ ì‹œê°„ê³¼ í•œêµ­ ì‹œê°„ì˜ ì°¨ì´ë¥¼ ë³´ì •í•©ë‹ˆë‹¤.
            
            ìˆ˜ì • ë°©ë²•:
            - ë‹¤ë¥¸ ì‹œê°„ëŒ€ ì‚¬ìš©: UTC+9 ëŒ€ì‹  ì›í•˜ëŠ” ì‹œê°„ëŒ€ ìˆ«ì ë³€ê²½
            - ì‹œê°„ í˜•ì‹ ë³€ê²½: ì‹œê°„ í‘œì‹œ í˜•ì‹ ìˆ˜ì •
            */
            
            // í˜„ì¬ í•œêµ­ ì‹œê°„ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
            function getKoreaTime() {
                const now = new Date(); // í˜„ì¬ ì‹œê°„
                const utc = now.getTime() + (now.getTimezoneOffset() * 60000); // UTC ì‹œê°„ìœ¼ë¡œ ë³€í™˜
                return new Date(utc + (9 * 3600000)); // UTC+9 (í•œêµ­ ì‹œê°„)ë¡œ ë³€í™˜
            }
            
            // íŠ¹ì • ë‚ ì§œì˜ í•œêµ­ ì‹œê°„ì„ ì„¤ì •í•˜ëŠ” í•¨ìˆ˜
            function setKoreaTime(date, hours = 0, minutes = 0, seconds = 0) {
                const koreaTime = new Date(date); // ë‚ ì§œ ë³µì‚¬
                koreaTime.setHours(hours, minutes, seconds, 0); // ì‹œê°„ ì„¤ì •
                return koreaTime; // ì„¤ì •ëœ ì‹œê°„ ë°˜í™˜
            }

            /* 
            ===========================================
            ì „ì—­ ë³€ìˆ˜ë“¤ - ì•± ìƒíƒœ ê´€ë¦¬
            ===========================================
            
            ì´ ë³€ìˆ˜ë“¤ì€ ì•±ì˜ í˜„ì¬ ìƒíƒœë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
            ì‚¬ìš©ì ì •ë³´, ì˜ˆì•½ ë°ì´í„°, í˜„ì¬ ë‚ ì§œ ë“±ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
            
            ìˆ˜ì • ë°©ë²•:
            - ì´ˆê¸°ê°’ ë³€ê²½: ë³€ìˆ˜ ì„ ì–¸ ì‹œ ê¸°ë³¸ê°’ ìˆ˜ì •
            - ìƒˆ ë³€ìˆ˜ ì¶”ê°€: í•„ìš”í•œ ë°ì´í„°ë¥¼ ì €ì¥í•  ë³€ìˆ˜ ì¶”ê°€
            */
            
            let users = []; // ëª¨ë“  ì‚¬ìš©ì ëª©ë¡
            let reservations = []; // ëª¨ë“  ì˜ˆì•½ ëª©ë¡
            let currentUser = null; // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì
            let firebaseUser = null; // Firebase ì¸ì¦ ì‚¬ìš©ì
            let notices = []; // ê³µì§€ì‚¬í•­ ëª©ë¡

            let currentDate = getKoreaTime(); // í˜„ì¬ ë‚ ì§œ
            let calendarDisplayDate = getKoreaTime(); // ë‹¬ë ¥ì— í‘œì‹œë˜ëŠ” ë‚ ì§œ

            /* 
            ===========================================
            DOM ìš”ì†Œ ì°¸ì¡° - HTML ìš”ì†Œë“¤ì„ JavaScriptì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì°¸ì¡°
            ===========================================
            
            ì´ ë¶€ë¶„ì—ì„œ HTMLì˜ ê° ìš”ì†Œë“¤ì„ JavaScript ë³€ìˆ˜ë¡œ ì—°ê²°í•©ë‹ˆë‹¤.
            ì´ë ‡ê²Œ í•˜ë©´ JavaScriptì—ì„œ HTML ìš”ì†Œë“¤ì„ ì‰½ê²Œ ì¡°ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            
            ìˆ˜ì • ë°©ë²•:
            - ìƒˆ ìš”ì†Œ ì¶”ê°€: document.getElementById('ìƒˆìš”ì†ŒID') ì¶”ê°€
            - ìš”ì†Œ ì´ë¦„ ë³€ê²½: HTMLì˜ idì™€ ì—¬ê¸° ë³€ìˆ˜ëª…ì„ í•¨ê»˜ ë³€ê²½
            */
            
            // ë¡œë”© ê´€ë ¨ ìš”ì†Œë“¤
            const loadingOverlay = document.getElementById('loading-overlay'); // ë¡œë”© í™”ë©´ ì „ì²´
            const loadingIndicator = document.getElementById('loading-indicator'); // ë¡œë”© ë©”ì‹œì§€

            // ë©”ì¸ í™”ë©´ ìš”ì†Œë“¤
            const authView = document.getElementById('auth-view'); // ë¡œê·¸ì¸/íšŒì›ê°€ì… í™”ë©´
            const mainView = document.getElementById('main-view'); // ë©”ì¸ ì•± í™”ë©´
            const adminView = document.getElementById('admin-view'); // ê´€ë¦¬ì íŒ¨ë„ í™”ë©´
            const monthlyView = document.getElementById('monthly-view'); // ì›”ê°„ ë‹¬ë ¥ í™”ë©´
            const dailyView = document.getElementById('daily-view'); // ì¼ê°„ ë‹¬ë ¥ í™”ë©´
            const myReservationsView = document.getElementById('my-reservations-view'); // ë‚´ ì˜ˆì•½ ëª©ë¡ í™”ë©´
            
            // ë¡œê·¸ì¸/íšŒì›ê°€ì… í¼ ìš”ì†Œë“¤
            const loginFormContainer = document.getElementById('login-form-container'); // ë¡œê·¸ì¸ í¼ ì˜ì—­
            const registerFormContainer = document.getElementById('register-form-container'); // íšŒì›ê°€ì… í¼ ì˜ì—­

            // ë²„íŠ¼ ìš”ì†Œë“¤
            const showRegisterBtn = document.getElementById('show-register-btn'); // íšŒì›ê°€ì… í™”ë©´ ì „í™˜ ë²„íŠ¼
            const showLoginBtn = document.getElementById('show-login-btn'); // ë¡œê·¸ì¸ í™”ë©´ ì „í™˜ ë²„íŠ¼
            const loginForm = document.getElementById('login-form'); // ë¡œê·¸ì¸ í¼
            const registerForm = document.getElementById('register-form'); // íšŒì›ê°€ì… í¼
            const logoutBtn = document.getElementById('logout-btn'); // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼
            
            // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ë“¤
            const adminPanelBtn = document.getElementById('admin-panel-btn'); // ê´€ë¦¬ì íŒ¨ë„ ë²„íŠ¼
            const backToMainBtn = document.getElementById('back-to-main-btn'); // ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼
            const editProfileBtn = document.getElementById('edit-profile-btn'); // ë‚´ ì •ë³´ ìˆ˜ì • ë²„íŠ¼
            const backToCalendarBtn = document.getElementById('back-to-calendar-btn'); // ë‹¬ë ¥ìœ¼ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼
            const myReservationsBtn = document.getElementById('my-reservations-btn'); // ë‚´ ì˜ˆì•½ ë²„íŠ¼
            const backToCalendarFromMyReservationsBtn = document.getElementById('back-to-calendar-from-my-reservations-btn'); // ë‚´ ì˜ˆì•½ì—ì„œ ë‹¬ë ¥ìœ¼ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼

            // ë‹¬ë ¥ ê´€ë ¨ ìš”ì†Œë“¤
            const timeGridContainer = document.getElementById('time-grid-container'); // ì‹œê°„ ê·¸ë¦¬ë“œ ì»¨í…Œì´ë„ˆ
            const mainCalendarContainer = document.getElementById('main-calendar-container'); // ë©”ì¸ ë‹¬ë ¥ ì»¨í…Œì´ë„ˆ

            // ì˜ˆì•½ ëª¨ë‹¬ ê´€ë ¨ ìš”ì†Œë“¤
            const reservationModal = document.getElementById('reservation-modal'); // ì˜ˆì•½ ëª¨ë‹¬ ì „ì²´
            const modalViewContent = document.getElementById('modal-view-content'); // ì˜ˆì•½ ì •ë³´ ë³´ê¸° ì˜ì—­
            const modalFormContent = document.getElementById('modal-form-content'); // ì˜ˆì•½ ìˆ˜ì • í¼ ì˜ì—­
            const reservationPurpose = document.getElementById('reservation-purpose'); // ì˜ˆì•½ ëª©ì  ì„ íƒ
            const reservationDuration = document.getElementById('reservation-duration'); // ì˜ˆì•½ ì‹œê°„ ì„ íƒ
            const performanceNameWrapper = document.getElementById('performance-name-wrapper'); // ê³µì—°ëª… ì…ë ¥ ì˜ì—­
            const participantsInput = document.getElementById('participants'); // ì°¸ì—¬ì ì…ë ¥ í•„ë“œ
            const modalError = document.getElementById('modal-error'); // ëª¨ë‹¬ ì˜¤ë¥˜ ë©”ì‹œì§€
            const cancelConfirmContainer = document.getElementById('cancel-confirm-container'); // ì·¨ì†Œ í™•ì¸ ì˜ì—­
            const viewModalButtons = document.getElementById('view-modal-buttons'); // ëª¨ë‹¬ ë²„íŠ¼ë“¤

            // ê¸°íƒ€ ëª¨ë‹¬ ìš”ì†Œë“¤
            const editUserModal = document.getElementById('edit-user-modal'); // íšŒì› ì •ë³´ ìˆ˜ì • ëª¨ë‹¬
            const editProfileModal = document.getElementById('edit-profile-modal'); // ë‚´ ì •ë³´ ìˆ˜ì • ëª¨ë‹¬
            const confirmationModal = document.getElementById('confirmation-modal'); // í™•ì¸ ëª¨ë‹¬
            
            /* 
            ===========================================
            ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤ - ê³µí†µìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ë„ìš°ë¯¸ í•¨ìˆ˜ë“¤
            ===========================================
            */
            
            // ë¡œë”© ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
            function showLoadingError(message) {
                 loadingIndicator.innerHTML = `<p class="text-red-600 font-semibold">${message}</p><p class="mt-2 text-sm text-gray-600">ì ì‹œ í›„ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>`;
            }

            /* 
            ===========================================
            Firebase ì´ˆê¸°í™” í•¨ìˆ˜ - ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„¤ì •
            ===========================================
            
            ì´ í•¨ìˆ˜ëŠ” Firebase ì„œë¹„ìŠ¤ì™€ì˜ ì—°ê²°ì„ ì„¤ì •í•©ë‹ˆë‹¤.
            ì•±ì´ ì‹œì‘ë  ë•Œ ê°€ì¥ ë¨¼ì € ì‹¤í–‰ë˜ëŠ” ì¤‘ìš”í•œ í•¨ìˆ˜ì…ë‹ˆë‹¤.
            
            ìˆ˜ì • ë°©ë²•:
            - íƒ€ì„ì•„ì›ƒ ì‹œê°„ ë³€ê²½: 10000 (10ì´ˆ) ê°’ì„ ì›í•˜ëŠ” ì‹œê°„ìœ¼ë¡œ ë³€ê²½
            - ì˜¤ë¥˜ ë©”ì‹œì§€ ë³€ê²½: showLoadingError í•¨ìˆ˜ì˜ ë©”ì‹œì§€ ìˆ˜ì •
            */
            
            async function initializeAppWithFirebase() {
                 // 10ì´ˆ í›„ì—ë„ ì—°ê²°ë˜ì§€ ì•Šìœ¼ë©´ íƒ€ì„ì•„ì›ƒ ì˜¤ë¥˜ í‘œì‹œ
                 const loadingTimeout = setTimeout(() => {
                    showLoadingError("ì—°ê²°ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                }, 10000);

                try {
                    // Firebase ì•± ì´ˆê¸°í™”
                    app = initializeApp(firebaseConfig);
                    db = getFirestore(app); // ë°ì´í„°ë² ì´ìŠ¤ ê°ì²´ ìƒì„±
                    auth = getAuth(app); // ì¸ì¦ ê°ì²´ ìƒì„±
                    
                    // Firebase ì´ˆê¸°í™” ì™„ë£Œ í›„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                    setupRegisterFormListener(); // íšŒì›ê°€ì… í¼ ì´ë²¤íŠ¸ ì„¤ì •
                    setupLoginFormListener(); // ë¡œê·¸ì¸ í¼ ì´ë²¤íŠ¸ ì„¤ì •
                    
                    // ì‚¬ìš©ì ë¡œê·¸ì¸ ìƒíƒœ ë³€í™” ê°ì§€
                    onAuthStateChanged(auth, async (user) => {
                        firebaseUser = user; // Firebase ì‚¬ìš©ì ì •ë³´ ì €ì¥
                        if (user) {
                           await setupListeners(); // ë¡œê·¸ì¸ëœ ì‚¬ìš©ììš© ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                        } else {
                           loadingOverlay.classList.add('hidden'); // ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê¸°
                           showView('auth'); // ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ
                        }
                    });

                    clearTimeout(loadingTimeout); // íƒ€ì„ì•„ì›ƒ ì·¨ì†Œ

                } catch (error) {
                    console.error("Firebase ì´ˆê¸°í™” ì˜¤ë¥˜:", error);
                    clearTimeout(loadingTimeout);
                    showLoadingError("ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                }
            }
            
            /* 
            ===========================================
            ë°ì´í„°ë² ì´ìŠ¤ ë¦¬ìŠ¤ë„ˆ ì„¤ì • í•¨ìˆ˜ - ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™”
            ===========================================
            
            ì´ í•¨ìˆ˜ëŠ” Firebase ë°ì´í„°ë² ì´ìŠ¤ì˜ ë³€í™”ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ê°ì§€í•©ë‹ˆë‹¤.
            ì‚¬ìš©ì ë°ì´í„°ë‚˜ ì˜ˆì•½ ë°ì´í„°ê°€ ë³€ê²½ë˜ë©´ ìë™ìœ¼ë¡œ í™”ë©´ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
            
            ìˆ˜ì • ë°©ë²•:
            - ê´€ë¦¬ì ê³„ì • ì •ë³´ ë³€ê²½: adminUser ê°ì²´ì˜ ê°’ë“¤ ìˆ˜ì •
            - ìƒˆ ì»¬ë ‰ì…˜ ì¶”ê°€: ìƒˆë¡œìš´ onSnapshot ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            */
            
            async function setupListeners() {
                // Firebase ì»¬ë ‰ì…˜ ì°¸ì¡° ìƒì„±
                const usersCollection = collection(db, 'users'); // ì‚¬ìš©ì ì»¬ë ‰ì…˜
                const reservationsCollection = collection(db, 'reservations'); // ì˜ˆì•½ ì»¬ë ‰ì…˜

                // ê´€ë¦¬ì ê³„ì •ì´ ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ ìƒì„±
                const adminQuery = query(usersCollection, where("email", "==", "admin@admin.com"));
                const adminSnapshot = await getDocs(adminQuery);
                if (adminSnapshot.empty) {
                    try {
                        // ê¸°ë³¸ ê´€ë¦¬ì ê³„ì • ì •ë³´ (í•„ìš”ì‹œ ìˆ˜ì •)
                        const adminUser = {
                            email: 'admin@admin.com', // ê´€ë¦¬ì ì´ë©”ì¼
                            student_id: 'admin', // ê´€ë¦¬ì í•™ë²ˆ
                            name: 'ê´€ë¦¬ì', // ê´€ë¦¬ì ì´ë¦„
                            department_code: '00', // ê´€ë¦¬ì í•™ê³¼ ì½”ë“œ
                            phone_number: '000-0000-0000', // ê´€ë¦¬ì ì „í™”ë²ˆí˜¸
                            nickname: 'ê´€ë¦¬ì', // ê´€ë¦¬ì ë‹‰ë„¤ì„
                            is_admin: true, // ê´€ë¦¬ì ê¶Œí•œ
                            can_reserve: true, // ì˜ˆì•½ ê¶Œí•œ
                        };
                         await addDoc(usersCollection, adminUser); // ê´€ë¦¬ì ê³„ì • ìƒì„±
                    } catch (error) {
                        console.error("Error creating admin user:", error);
                    }
                }

                onSnapshot(usersCollection, (snapshot) => {
                    console.log('Firebaseì—ì„œ ì‚¬ìš©ì ë°ì´í„° ìˆ˜ì‹ ë¨');
                    console.log('snapshot.docs ê°œìˆ˜:', snapshot.docs.length);
                    
                    users = snapshot.docs.map(doc => {
                        const data = doc.data();
                        console.log(`ì‚¬ìš©ì ${doc.id}:`, data);
                        console.log(`- name: ${data.name}`);
                        console.log(`- nickname: ${data.nickname}`);
                        console.log(`- student_id: ${data.student_id}`);
                        console.log(`- email: ${data.email}`);
                        console.log(`- password: ${data.password}`);
                        console.log(`- phone_number: ${data.phone_number}`);
                        console.log(`- is_admin: ${data.is_admin}`);
                        console.log(`- can_reserve: ${data.can_reserve}`);
                        console.log(`- is_notice: ${data.is_notice}`);
                        return { id: doc.id, ...data };
                    });
                    
                    console.log('ìµœì¢… users ë°°ì—´:', users);
                    
                     if (firebaseUser) {
                        const q = query(usersCollection, where("email", "==", firebaseUser.email));
                        getDocs(q).then(userSnapshot => {
                            if (!userSnapshot.empty) {
                                currentUser = { id: userSnapshot.docs[0].id, ...userSnapshot.docs[0].data() };
                                if (currentUser && !mainView.classList.contains('hidden')) {
                                     document.getElementById('user-nickname').textContent = `í™˜ì˜í•©ë‹ˆë‹¤, ${currentUser.nickname}ë‹˜`;
                                     adminPanelBtn.classList.toggle('hidden', !currentUser.is_admin);
                                     
                                     // ë‹¬ë ¥ ë‹¤ì‹œ ë Œë”ë§ (ì‚¬ìš©ì ê¶Œí•œ ë³€ê²½ ì‹œ)
                                     if (!monthlyView.classList.contains('hidden')) {
                                         renderMainCalendar();
                                         renderNotices();
                                     }
                                }
                            }
                        });
                    }
                    
                    if(!adminView.classList.contains('hidden')) {
                        console.log('ê´€ë¦¬ì íŒ¨ë„ì´ í™œì„±í™”ë¨, íšŒì› ê´€ë¦¬ í…Œì´ë¸” ë Œë”ë§');
                        renderUserManagementTable();
                    }

                    loadingOverlay.classList.add('hidden');
                }, (error) => {
                    console.error("ì‚¬ìš©ì ë°ì´í„° ìˆ˜ì‹  ì˜¤ë¥˜:", error);
                    showLoadingError("ì‚¬ìš©ì ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                });
                
                onSnapshot(reservationsCollection, (snapshot) => {
                    reservations = snapshot.docs.map(doc => {
                        const data = doc.data();
                        return { 
                            id: doc.id, 
                            ...data,
                            start_time: data.start_time.toDate(),
                            end_time: data.end_time.toDate()
                        }
                    }).filter(reservation => {
                        // ê³µì§€ì‚¬í•­ ê´€ë ¨ ì˜ˆì•½ ì œì™¸
                        if (reservation.booker && reservation.booker.nickname === 'ê³µì§€ì‚¬í•­') {
                            console.log('ê³µì§€ì‚¬í•­ ì˜ˆì•½ ì œì™¸:', reservation);
                            return false;
                        }
                        return true;
                    });
                    
                    if(!mainView.classList.contains('hidden')) {
                        if (!monthlyView.classList.contains('hidden')) {
                            renderMainCalendar();
                            renderNotices();
                        }
                        if (!dailyView.classList.contains('hidden')) renderTimeGrid();
                        if (!myReservationsView.classList.contains('hidden')) renderMyReservations();
                    }
                }, (error) => {
                     console.error("ì˜ˆì•½ ë°ì´í„° ìˆ˜ì‹  ì˜¤ë¥˜:", error);
                     showLoadingError("ì˜ˆì•½ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                });
                
                // ê³µì§€ì‚¬í•­ ë¡œë“œ
                await loadNotices();
                
                if (firebaseUser) {
                    showView('main');
                } else {
                    showView('auth');
                }
            }
            
            function createNickname(name, studentId) {
                if (!studentId || studentId.length < 6) return name;
                const admissionYear = studentId.substring(2, 4);
                const deptCode = studentId.substring(4, 6);
                const deptName = DEPT_MAP[deptCode] || 'ê¸°íƒ€';
                return `${name}${deptName}${admissionYear}`;
            }

            function showView(viewName) {
                authView.classList.add('hidden');
                mainView.classList.add('hidden');
                adminView.classList.add('hidden');
                myReservationsView.classList.add('hidden');

                if (viewName === 'auth') {
                    authView.classList.remove('hidden');
                } else if (viewName === 'main') {
                    mainView.classList.remove('hidden');
                    showMonthlyView();
                } else if (viewName === 'admin') {
                    adminView.classList.remove('hidden');
                    checkNoticeUser(); // ê³µì§€ì‚¬í•­ íšŒì› í™•ì¸
                    cleanupInvalidNotices().then(() => {
                        renderUserManagementTable();
                    });
                }
            }
            
            function showMonthlyView() {
                if (dailyView) dailyView.classList.add('hidden');
                if (myReservationsView) myReservationsView.classList.add('hidden');
                if (monthlyView) monthlyView.classList.remove('hidden');
                
                calendarDisplayDate = setKoreaTime(currentDate, 0, 0, 0);
                calendarDisplayDate.setDate(1);
                
                // ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ê³  ë‹¬ë ¥ ë Œë”ë§ (DOM ì—…ë°ì´íŠ¸ ì™„ë£Œ í›„)
                setTimeout(() => {
                    renderMainCalendar();
                    renderNotices();
                }, 100);
            }

            function showDailyView(date) {
                currentDate = date;
                monthlyView.classList.add('hidden');
                myReservationsView.classList.add('hidden');
                dailyView.classList.remove('hidden');
                const dateStr = currentDate.toLocaleDateString('ko-KR', {
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric'
                });
                const weekdayStr = currentDate.toLocaleDateString('ko-KR', {
                    weekday: 'long'
                });
                document.getElementById('daily-view-date').innerHTML = `
                    <div class="text-xl font-bold text-gray-800">${dateStr}</div>
                    <div class="text-lg text-gray-600 mt-1">${weekdayStr}</div>
                `;
                renderTimeGrid();
                 document.getElementById('daily-legend').innerHTML = `
                    <div class="flex items-center"><span class="w-4 h-4 bg-[#A3BFFA] mr-2 rounded"></span><span>ê°œì¸ ì—°ìŠµ</span></div>
                    <div class="flex items-center"><span class="w-4 h-4 bg-[#FBBF24] mr-2 rounded"></span><span>ê³µì—° ì—°ìŠµ</span></div>
                    ${currentUser.is_admin ? `
                    <div class="flex items-center"><span class="w-4 h-4 bg-[#A7F3D0] mr-2 rounded"></span><span>ê¸°íƒ€ ê°•ìŠµ</span></div>
                    <div class="flex items-center"><span class="w-4 h-4 bg-[#DDD6FE] mr-2 rounded"></span><span>ì§‘ë¶€ íšŒì˜</span></div>
                     <div class="flex items-center"><span class="w-4 h-4 bg-[#D1D5DB] mr-2 rounded"></span><span>ê¸°íƒ€</span></div>` : ''}
                `;
            }

             function showMyReservationsView() {
                monthlyView.classList.add('hidden');
                dailyView.classList.add('hidden');
                myReservationsView.classList.remove('hidden');
                renderMyReservations();
            }
            
            backToCalendarBtn.addEventListener('click', showMonthlyView);
            myReservationsBtn.addEventListener('click', showMyReservationsView);
            backToCalendarFromMyReservationsBtn.addEventListener('click', showMonthlyView);
            

            // ë‚ ì§œ ì´ë™ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('prev-day-btn').addEventListener('click', () => {
                // ê³¼ê±° ë‚ ì§œë¡œë„ ì´ë™ ê°€ëŠ¥í•˜ë„ë¡ ì œí•œ ì œê±°
                const prevDay = new Date(currentDate);
                prevDay.setDate(prevDay.getDate() - 1);
                currentDate = prevDay;
                showDailyView(currentDate);
            });

            document.getElementById('next-day-btn').addEventListener('click', () => {
                const nextDay = new Date(currentDate);
                nextDay.setDate(nextDay.getDate() + 1);
                currentDate = nextDay;
                showDailyView(currentDate);
            });

            // ê³µì§€ì‚¬í•­ ê´€ë¦¬ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('save-notice-btn').addEventListener('click', saveNotice);
            
            // ê³µì§€ì‚¬í•­ ì¶”ê°€/ì·¨ì†Œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('show-notice-add-btn').addEventListener('click', () => {
                document.getElementById('notice-add-section').classList.remove('hidden');
                document.getElementById('notice-add-button-container').classList.add('hidden');
            });
            
            document.getElementById('cancel-notice-btn').addEventListener('click', () => {
                document.getElementById('notice-add-section').classList.add('hidden');
                document.getElementById('notice-add-button-container').classList.remove('hidden');
                document.getElementById('notice-text').value = '';
            });

            showRegisterBtn.addEventListener('click', () => {
                loginFormContainer.classList.add('hidden');
                registerFormContainer.classList.remove('hidden');
            });

            showLoginBtn.addEventListener('click', () => {
                registerFormContainer.classList.add('hidden');
                loginFormContainer.classList.remove('hidden');
            });
            
            // íšŒì›ê°€ì… í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • í•¨ìˆ˜
            function setupRegisterFormListener() {
                if (registerForm) {
                    registerForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        
                        // Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ëŒ€ê¸°
                        if (!db || !auth) {
                            console.error("Firebaseê°€ ì•„ì§ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                            return;
                        }
                        
                        const name = document.getElementById('register-name').value;
                        const studentId = document.getElementById('register-student-id').value;
                        const email = document.getElementById('register-email').value;
                        const phone = document.getElementById('register-phone').value;
                        const password = document.getElementById('register-password').value;
                        const errorEl = document.getElementById('register-error');

                        const q = query(collection(db, 'users'), where("student_id", "==", studentId));
                        const querySnapshot = await getDocs(q);
                        if (!querySnapshot.empty) {
                             errorEl.textContent = 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ í•™ë²ˆì…ë‹ˆë‹¤.';
                            errorEl.classList.remove('hidden');
                            return;
                        }

                        if (studentId.length < 6) {
                             errorEl.textContent = 'ìœ íš¨í•˜ì§€ ì•Šì€ í•™ë²ˆ í˜•ì‹ì…ë‹ˆë‹¤.';
                            errorEl.classList.remove('hidden');
                            return;
                        }
                        errorEl.classList.add('hidden');
                        
                        try {
                            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                            const is_admin = email === 'admin@admin.com';
                            const newUser = {
                                uid: userCredential.user.uid,
                                email, student_id: studentId, name,
                                department_code: studentId.substring(4, 6),
                                phone_number: phone,
                                nickname: createNickname(name, studentId),
                                password: password, // ê´€ë¦¬ìê°€ ë³¼ ìˆ˜ ìˆë„ë¡ ë¹„ë°€ë²ˆí˜¸ ì €ì¥
                                is_admin,
                                can_reserve: true,
                                is_notice: false
                            };
                            
                            console.log('ìƒˆ ì‚¬ìš©ì ë°ì´í„°:', newUser);
                            await addDoc(collection(db, 'users'), newUser);
                            console.log('ì‚¬ìš©ì ë°ì´í„° ì €ì¥ ì™„ë£Œ');
                            alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                            registerForm.reset();
                            showLoginBtn.click();
                        } catch (error) {
                             if (error.code === 'auth/email-already-in-use') {
                                errorEl.textContent = 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.';
                            } else if (error.code === 'auth/weak-password') {
                                errorEl.textContent = 'ë¹„ë°€ë²ˆí˜¸ëŠ” 6ìë¦¬ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                            } else {
                                errorEl.textContent = 'íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                            }
                            errorEl.classList.remove('hidden');
                            console.error("íšŒì›ê°€ì… ì˜¤ë¥˜:", error);
                        }
                    });
                }
            }

            // ë¡œê·¸ì¸ í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • í•¨ìˆ˜
            function setupLoginFormListener() {
                if (loginForm) {
                    loginForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        
                        // Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ëŒ€ê¸°
                        if (!db || !auth) {
                            console.error("Firebaseê°€ ì•„ì§ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                            return;
                        }
                        
                        const loginInput = document.getElementById('login-student-id').value;
                        const password = document.getElementById('login-password').value;
                        const errorEl = document.getElementById('login-error');
                        
                        try {
                            // í•™ë²ˆì¸ì§€ ì´ë©”ì¼ì¸ì§€ í™•ì¸
                            let email;
                            if (loginInput.includes('@')) {
                                // ì´ë©”ì¼ë¡œ ë¡œê·¸ì¸
                                email = loginInput;
                                console.log('ì´ë©”ì¼ë¡œ ë¡œê·¸ì¸ ì‹œë„:', email);
                            } else {
                                // í•™ë²ˆìœ¼ë¡œ ë¡œê·¸ì¸ - í•™ë²ˆìœ¼ë¡œ ì‚¬ìš©ì ì°¾ê¸°
                                console.log('í•™ë²ˆìœ¼ë¡œ ë¡œê·¸ì¸ ì‹œë„:', loginInput);
                                const studentIdQuery = query(collection(db, 'users'), where("student_id", "==", loginInput));
                                const studentIdSnapshot = await getDocs(studentIdQuery);
                                console.log('í•™ë²ˆ ê²€ìƒ‰ ê²°ê³¼:', studentIdSnapshot.docs.length, 'ê°œ');
                                
                                if (studentIdSnapshot.empty) {
                                    errorEl.textContent = 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í•™ë²ˆì…ë‹ˆë‹¤.';
                                    errorEl.classList.remove('hidden');
                                    return;
                                }
                                email = studentIdSnapshot.docs[0].data().email;
                                console.log('ì°¾ì€ ì´ë©”ì¼:', email);
                            }
                            
                            await signInWithEmailAndPassword(auth, email, password);
                            const q = query(collection(db, 'users'), where("email", "==", email));
                            const querySnapshot = await getDocs(q);
                            
                            if (querySnapshot.empty) {
                                await signOut(auth); // Sign out if no user data found
                                errorEl.textContent = 'ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                                errorEl.classList.remove('hidden');
                                return;
                            }

                            const user = { id: querySnapshot.docs[0].id, ...querySnapshot.docs[0].data() };
                            if (!user.can_reserve) {
                                await signOut(auth);
                                errorEl.textContent = 'ì˜ˆì•½ ê¶Œí•œì´ ì—†ëŠ” ê³„ì •ì…ë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.';
                                errorEl.classList.remove('hidden');
                            } else {
                                 errorEl.classList.add('hidden');
                            }

                        } catch (error) {
                            errorEl.textContent = 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                            errorEl.classList.remove('hidden');
                            console.error("Login error:", error.code);
                        }
                    });
                }
            }

            logoutBtn.addEventListener('click', async () => {
                try {
                    await signOut(auth);
                    currentUser = null;
                    firebaseUser = null;
                } catch (error) {
                    console.error("ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:", error);
                }
            });
            
            adminPanelBtn.addEventListener('click', () => showView('admin'));
            backToMainBtn.addEventListener('click', () => showView('main'));

            // ê³µì§€ì‚¬í•­ ê´€ë ¨ í•¨ìˆ˜ë“¤
            function renderNotices() {
                console.log('renderNotices í˜¸ì¶œë¨');
                console.log('currentUser:', currentUser);
                console.log('notices:', notices);
                
                const noticesContainer = document.getElementById('notices-list-container');
                const noticeAddButtonContainer = document.getElementById('notice-add-button-container');
                
                if (!noticesContainer) {
                    console.error('notices-list-containerë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                if (!noticeAddButtonContainer) {
                    console.error('notice-add-button-containerë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                // ê´€ë¦¬ìì—ê²Œë§Œ ê³µì§€ì‚¬í•­ ì¶”ê°€ ë²„íŠ¼ í‘œì‹œ
                if (currentUser && currentUser.is_admin) {
                    console.log('ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ë¨, ê³µì§€ì‚¬í•­ ì¶”ê°€ ë²„íŠ¼ í‘œì‹œ');
                    noticeAddButtonContainer.classList.remove('hidden');
                } else {
                    console.log('ì¼ë°˜ ì‚¬ìš©ì, ê³µì§€ì‚¬í•­ ì¶”ê°€ ë²„íŠ¼ ìˆ¨ê¹€');
                    noticeAddButtonContainer.classList.add('hidden');
                }
                
                if (notices.length === 0) {
                    noticesContainer.innerHTML = `
                        <div class="text-center text-gray-500 py-4">
                            ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.
                        </div>
                    `;
                    return;
                }
                
                // ê³µì§€ì‚¬í•­ì„ ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬
                const sortedNotices = notices.sort((a, b) => b.created_at.seconds - a.created_at.seconds);
                
                noticesContainer.innerHTML = sortedNotices.map(notice => `
                    <div class="border-l-4 border-blue-400 bg-blue-50 p-4 mb-3 rounded-r-lg">
                        <div class="flex justify-between items-start mb-2">
                            <div class="text-sm text-blue-600">
                                ${notice.created_by_name || notice.nickname || 'ê´€ë¦¬ì'} â€¢ ${new Date(notice.created_at.seconds * 1000).toLocaleDateString('ko-KR')}
                            </div>
                            ${currentUser && currentUser.is_admin ? `
                                <button class="delete-notice-btn text-red-500 hover:text-red-700 text-sm" data-notice-id="${notice.id}">
                                    ì‚­ì œ
                                </button>
                            ` : ''}
                        </div>
                        <div class="text-sm text-blue-700 whitespace-pre-wrap">${notice.content}</div>
                    </div>
                `).join('');
                
                // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                noticesContainer.querySelectorAll('.delete-notice-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const noticeId = e.target.dataset.noticeId;
                        deleteNotice(noticeId);
                    });
                });
            }

            async function loadNotices() {
                try {
                    console.log('ê³µì§€ì‚¬í•­ ë¡œë“œ ì‹œì‘');
                    // users ì»¬ë ‰ì…˜ì—ì„œ ê³µì§€ì‚¬í•­ë“¤ì„ ë¡œë“œ (ë³´ì•ˆ ê·œì¹™ ë¬¸ì œ íšŒí”¼)
                    const noticesQuery = query(collection(db, 'users'), where('is_notice', '==', true));
                    const noticesSnapshot = await getDocs(noticesQuery);
                    notices = noticesSnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    console.log('ë¡œë“œëœ ê³µì§€ì‚¬í•­ë“¤:', notices);
                    renderNotices();
                } catch (error) {
                    console.error('ê³µì§€ì‚¬í•­ ë¡œë“œ ì˜¤ë¥˜:', error);
                    notices = [];
                    renderNotices();
                }
            }

            async function saveNotice() {
                const noticeText = document.getElementById('notice-text').value.trim();
                if (!noticeText) {
                    alert('ê³µì§€ì‚¬í•­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                try {
                    console.log('ê³µì§€ì‚¬í•­ ì €ì¥ ì‹œì‘...');
                    console.log('í˜„ì¬ ì‚¬ìš©ì:', currentUser);
                    console.log('ê³µì§€ì‚¬í•­ ë‚´ìš©:', noticeText);
                    
                    const noticeData = {
                        content: noticeText,
                        created_at: Timestamp.now(),
                        created_by: currentUser.id,
                        created_by_name: currentUser.nickname || currentUser.name,
                        is_notice: true,  // ê³µì§€ì‚¬í•­ì„ì„ í‘œì‹œ
                        email: 'notice@system.com',  // í•„ìˆ˜ í•„ë“œ
                        student_id: 'notice',
                        name: 'ê³µì§€ì‚¬í•­',
                        department_code: '00',
                        phone_number: '000-0000-0000',
                        nickname: 'ê³µì§€ì‚¬í•­',
                        is_admin: false,
                        can_reserve: false
                    };
                    
                    console.log('ì €ì¥í•  ë°ì´í„°:', noticeData);
                    
                    // users ì»¬ë ‰ì…˜ì— ê³µì§€ì‚¬í•­ìœ¼ë¡œ ì €ì¥ (ë³´ì•ˆ ê·œì¹™ ë¬¸ì œ íšŒí”¼)
                    const docRef = await addDoc(collection(db, 'users'), noticeData);
                    console.log('ê³µì§€ì‚¬í•­ ì €ì¥ ì„±ê³µ! ID:', docRef.id);
                    
                    // ê³µì§€ì‚¬í•­ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    await loadNotices();
                    document.getElementById('notice-text').value = '';
                    
                    // ì…ë ¥ í¼ ìˆ¨ê¸°ê¸°
                    document.getElementById('notice-add-section').classList.add('hidden');
                    document.getElementById('notice-add-button-container').classList.remove('hidden');
                    
                    alert('ê³µì§€ì‚¬í•­ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } catch (error) {
                    console.error('ê³µì§€ì‚¬í•­ ì €ì¥ ì˜¤ë¥˜ ìƒì„¸:', error);
                    console.error('ì˜¤ë¥˜ ì½”ë“œ:', error.code);
                    console.error('ì˜¤ë¥˜ ë©”ì‹œì§€:', error.message);
                    alert(`ê³µì§€ì‚¬í•­ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\nì˜¤ë¥˜: ${error.message}\nê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.`);
                }
            }

            async function deleteNotice(noticeId) {
                if (!confirm('ì´ ê³µì§€ì‚¬í•­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    return;
                }
                
                try {
                    await deleteDoc(doc(db, 'users', noticeId));
                    console.log('ê³µì§€ì‚¬í•­ ì‚­ì œ ì„±ê³µ! ID:', noticeId);
                    
                    // ê³µì§€ì‚¬í•­ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    await loadNotices();
                    alert('ê³µì§€ì‚¬í•­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                } catch (error) {
                    console.error('ê³µì§€ì‚¬í•­ ì‚­ì œ ì˜¤ë¥˜:', error);
                    alert('ê³µì§€ì‚¬í•­ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.');
                }
            }

            function renderMainCalendar() {
                if (!mainCalendarContainer) {
                    console.error('ë‹¬ë ¥ ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                mainCalendarContainer.innerHTML = '';
                const year = calendarDisplayDate.getFullYear();
                const month = calendarDisplayDate.getMonth();

                const header = document.createElement('div');
                header.className = 'mb-3';
                header.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <button id="cal-prev-month" class="w-10 h-10 rounded-full bg-gray-200 text-gray-800 flex items-center justify-center hover:bg-gray-300 transition-colors">
                            <span class="text-lg font-bold">&lt;</span>
                        </button>
                        <button id="cal-next-month" class="w-10 h-10 rounded-full bg-gray-200 text-gray-800 flex items-center justify-center hover:bg-gray-300 transition-colors">
                            <span class="text-lg font-bold">&gt;</span>
                        </button>
                    </div>
                    <div class="text-center">
                        <span class="text-lg font-bold text-gray-800">${year}ë…„ ${month + 1}ì›”</span>
                    </div>
                `;
                mainCalendarContainer.appendChild(header);

                const grid = document.createElement('div');
                grid.className = 'calendar-grid';
                const daysOfWeek = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
                daysOfWeek.forEach(day => {
                    const dayHeader = document.createElement('div');
                    dayHeader.className = 'font-bold text-gray-600 py-2 text-center flex items-center justify-center text-xs bg-gray-50 rounded-lg';
                    dayHeader.textContent = day;
                    grid.appendChild(dayHeader);
                });

                const firstDayOfMonth = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                
                const today = setKoreaTime(getKoreaTime(), 0, 0, 0);

                for (let i = 0; i < firstDayOfMonth; i++) {
                    const emptyEl = document.createElement('div');
                    emptyEl.className = 'calendar-day empty';
                    grid.appendChild(emptyEl);
                }

                for (let day = 1; day <= daysInMonth; day++) {
                    const thisDate = new Date(year, month, day);
                    const dayEl = document.createElement('div');
                    dayEl.className = 'calendar-day cursor-pointer';
                    
                    // ê°„ë‹¨í•œ ë‚ ì§œ í‘œì‹œ
                    dayEl.innerHTML = `<span class="day-number">${day}</span>`;
                    
                    if (thisDate < today) {
                        dayEl.classList.add('text-gray-400');
                        // ê³¼ê±° ë‚ ì§œë„ í´ë¦­ ê°€ëŠ¥í•˜ë„ë¡ cursor-not-allowed ì œê±°
                    }
                    
                    if (thisDate.toDateString() === today.toDateString()) {
                        dayEl.classList.add('today');
                    }
                    
                    if (currentUser && !currentUser.is_admin && thisDate >= today) {
                        const personalEnd = new Date(today);
                        personalEnd.setDate(today.getDate() + 1);
                        
                        const performanceEnd = new Date(today);
                        performanceEnd.setDate(today.getDate() + 7);

                        const isPersonalDay = thisDate >= today && thisDate <= personalEnd; // ë‹¹ì¼ê³¼ ë‹¤ìŒë‚ ë§Œ ê°œì¸ ì—°ìŠµ ê°€ëŠ¥
                        const isPerformanceDay = thisDate >= today && thisDate <= performanceEnd; // ë‹¹ì¼ë¶€í„° 7ì¼ ì „ê¹Œì§€ ê³µì—° ì—°ìŠµ ê°€ëŠ¥

                        if (isPersonalDay && isPerformanceDay) {
                            dayEl.classList.add('reservable-both');
                        } else if (isPerformanceDay) {
                             dayEl.classList.add('reservable-performance');
                        }
                    }

                    dayEl.dataset.date = thisDate.toISOString();
                    grid.appendChild(dayEl);
                }
                mainCalendarContainer.appendChild(grid);

                const legend = document.createElement('div');
                legend.className = 'mt-4 flex justify-center space-x-4 text-xs bg-white p-3 rounded-lg shadow-sm';
                legend.innerHTML = `
                    <div class="flex items-center"><span class="w-3 h-3 bg-[#E9D5FF] mr-1 rounded border border-[#A855F7]"></span>ê°œì¸/ê³µì—° ì˜ˆì•½ ê°€ëŠ¥</div>
                    <div class="flex items-center"><span class="w-3 h-3 bg-[#FEF3C7] mr-1 rounded border border-[#F59E0B]"></span>ê³µì—° ì—°ìŠµ ì˜ˆì•½ ê°€ëŠ¥</div>
                `;
                if (currentUser && !currentUser.is_admin) {
                     mainCalendarContainer.appendChild(legend);
                }
            }
            
            mainCalendarContainer.addEventListener('click', (e) => {
                if (e.target.id === 'cal-prev-month' || (e.target.parentElement && e.target.parentElement.id === 'cal-prev-month')) {
                    calendarDisplayDate.setMonth(calendarDisplayDate.getMonth() - 1);
                    renderMainCalendar();
                    renderNotices();
                }
                if (e.target.id === 'cal-next-month' || (e.target.parentElement && e.target.parentElement.id === 'cal-next-month')) {
                    calendarDisplayDate.setMonth(calendarDisplayDate.getMonth() + 1);
                    renderMainCalendar();
                    renderNotices();
                }
                const dayEl = e.target.closest('.calendar-day');
                if (dayEl && dayEl.dataset.date) {
                    // ê³¼ê±° ë‚ ì§œë„ í´ë¦­ ê°€ëŠ¥í•˜ë„ë¡ ì œí•œ ì œê±°
                    const clickedDate = new Date(dayEl.dataset.date);
                    showDailyView(clickedDate);
                }
            });


            function renderTimeGrid() {
                timeGridContainer.innerHTML = '';
                const now = getKoreaTime();
                for (let hour = 8; hour < 22; hour++) {
                    for (let minute = 0; minute < 60; minute += 30) {
                        const slotTime = new Date(currentDate);
                        slotTime.setHours(hour, minute, 0, 0);

                        const slotEl = document.createElement('div');
                        slotEl.classList.add('time-slot', 'transition-colors', 'duration-150');
                        
                        const timeString = `${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}`;
                        
                        const timeLabel = document.createElement('span');
                        timeLabel.textContent = timeString;
                        timeLabel.classList.add('time-label');
                        
                        const infoEl = document.createElement('div');
                        infoEl.classList.add('time-info');

                        const reservation = reservations.find(r => slotTime >= r.start_time && slotTime < r.end_time);
                        const isPastTime = slotTime < now;

                        if (isPastTime) {
                            // ì§€ë‚œ ì‹œê°„ì´ì§€ë§Œ ì˜ˆì•½ì´ ìˆìœ¼ë©´ í‘œì‹œí•˜ê³  í´ë¦­ ê°€ëŠ¥í•˜ê²Œ
                            slotEl.classList.add('past-time');
                            if (reservation) {
                                slotEl.classList.add(`is-reserved-${reservation.purpose}`);
                                slotEl.dataset.reservationId = reservation.id;
                                infoEl.textContent = `ì˜ˆì•½ì: ${reservation.booker.nickname} (${PURPOSE_MAP[reservation.purpose]})`;
                                // ì§€ë‚œ ì‹œê°„ ì˜ˆì•½ë„ í´ë¦­ ê°€ëŠ¥í•˜ê²Œ (ì½ê¸° ì „ìš©)
                                slotEl.style.cursor = 'pointer';
                                slotEl.style.opacity = '0.7'; // ì•½ê°„ íˆ¬ëª…í•˜ê²Œ í‘œì‹œ
                            } else {
                                infoEl.textContent = 'ì˜ˆì•½ ì—†ìŒ';
                            }
                        } else if (reservation) {
                            slotEl.classList.add(`is-reserved-${reservation.purpose}`);
                            slotEl.dataset.reservationId = reservation.id;
                            infoEl.textContent = `ì˜ˆì•½ì: ${reservation.booker.nickname} (${PURPOSE_MAP[reservation.purpose]})`;
                        } else {
                            slotEl.classList.add('cursor-pointer');
                            slotEl.dataset.time = slotTime.toISOString();
                        }
                        
                        slotEl.appendChild(timeLabel);
                        slotEl.appendChild(infoEl);
                        timeGridContainer.appendChild(slotEl);
                    }
                }
            }

            timeGridContainer.addEventListener('click', (e) => {
                const slot = e.target.closest('.time-slot, [class*="is-reserved-"]');
                if (!slot) return;
                
                // ì§€ë‚œ ì‹œê°„ ì˜ˆì•½ë„ í´ë¦­ ê°€ëŠ¥ (ì½ê¸° ì „ìš©)
                if (slot.classList.contains('past-time')) {
                    if (slot.dataset.reservationId) {
                        const reservation = reservations.find(r => r.id == slot.dataset.reservationId);
                        showReservationViewModal(reservation);
                    }
                    return;
                }
                
                if (slot.dataset.reservationId) {
                    const reservation = reservations.find(r => r.id == slot.dataset.reservationId);
                    showReservationViewModal(reservation);
                } else if (slot.dataset.time) {
                    showReservationFormModal(new Date(slot.dataset.time));
                }
            });
            
            function getPurposeDisplayName(purpose) {
                return PURPOSE_MAP[purpose] || purpose;
            }

            function showReservationViewModal(reservation) {
                modalFormContent.classList.add('hidden');
                modalViewContent.classList.remove('hidden');
                cancelConfirmContainer.classList.add('hidden');
                viewModalButtons.classList.remove('hidden');

                document.getElementById('view-booker').textContent = reservation.booker.nickname;
                const startTimeStr = reservation.start_time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const endTimeStr = reservation.end_time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                document.getElementById('view-time').textContent = `${startTimeStr} - ${endTimeStr}`;
                document.getElementById('view-purpose').textContent = getPurposeDisplayName(reservation.purpose);
                const perfNameContainer = document.getElementById('view-performance-name-container');
                if (reservation.purpose === 'performance') {
                    document.getElementById('view-performance-name').textContent = reservation.performance_name;
                    perfNameContainer.classList.remove('hidden');
                } else {
                    perfNameContainer.classList.add('hidden');
                }
                document.getElementById('view-participants').textContent = reservation.participants
                    .filter(p => p.nickname !== 'ê³µì§€ì‚¬í•­') // ê³µì§€ì‚¬í•­ ì œì™¸
                    .map(p => p.nickname)
                    .join(', ');
                
                const cancelBtn = document.getElementById('cancel-reservation-btn');
                const editBtn = document.getElementById('edit-reservation-btn');

                const isParticipant = reservation.participants.some(p => p.id === currentUser.id);
                const canModify = reservation.booker_id === currentUser.id || currentUser.is_admin || isParticipant;

                cancelBtn.classList.toggle('hidden', !canModify);
                editBtn.classList.toggle('hidden', !canModify);
                
                editBtn.onclick = () => showReservationFormModal(reservation.start_time, reservation);

                cancelBtn.onclick = () => {
                    viewModalButtons.classList.add('hidden');
                    cancelConfirmContainer.classList.remove('hidden');
                };
                
                document.getElementById('confirm-cancel-btn').onclick = async () => {
                    await deleteDoc(doc(db, 'reservations', reservation.id));
                    closeModal();
                };

                document.getElementById('abort-cancel-btn').onclick = () => {
                    viewModalButtons.classList.remove('hidden');
                    cancelConfirmContainer.classList.add('hidden');
                };

                document.getElementById('close-view-modal-btn').onclick = closeModal;
                reservationModal.classList.remove('hidden');
            }
            
            function renderParticipantSuggestions(searchText = '') {
                const suggestionList = document.getElementById('participant-suggestion-list');
                suggestionList.innerHTML = ''; 

                const searchLower = searchText.toLowerCase();
                const otherUsers = users.filter(u => 
                    u.id !== currentUser.id && 
                    !u.is_admin && 
                    u.nickname !== 'ê³µì§€ì‚¬í•­' // ê³µì§€ì‚¬í•­ ì œì™¸
                );

                const filteredUsers = otherUsers.filter(user => user.nickname.toLowerCase().includes(searchLower));

                filteredUsers.forEach(user => {
                    const btn = document.createElement('button');
                    btn.type = 'button';
                    btn.textContent = user.nickname;
                    btn.className = 'bg-gray-200 text-gray-800 text-xs px-2 py-1 rounded-full hover:bg-gray-300';
                    suggestionList.appendChild(btn);
                });
            }

            function handleParticipantSearch(e) {
                const terms = e.target.value.split(',').map(t => t.trim());
                const currentTerm = terms.pop() || '';
                renderParticipantSuggestions(currentTerm);
            }
            
            function showReservationFormModal(startTime, existingReservation = null) {
                if (!currentUser.can_reserve) {
                    alert('ì˜ˆì•½ì´ ë¹„í™œì„±í™”ëœ ê³„ì •ì…ë‹ˆë‹¤.');
                    return;
                }
                modalViewContent.classList.add('hidden');
                modalFormContent.classList.remove('hidden');
                modalFormContent.reset();
                performanceNameWrapper.classList.add('hidden');
                modalError.classList.add('hidden');
                document.getElementById('edit-reservation-id').value = existingReservation ? existingReservation.id : '';
                document.getElementById('save-reservation-btn').textContent = existingReservation ? 'ìˆ˜ì •í•˜ê¸°' : 'ì˜ˆì•½í•˜ê¸°';

                reservationPurpose.innerHTML = '';
                const standardOptions = { 'personal': 'ê°œì¸ ì—°ìŠµ', 'performance': 'ê³µì—° ì—°ìŠµ' };
                for (const [value, text] of Object.entries(standardOptions)) {
                    reservationPurpose.innerHTML += `<option value="${value}">${text}</option>`;
                }
                // ê¸°íƒ€ ê°•ìŠµìëŠ” ê¸°íƒ€ ê°•ìŠµ ëª©ì  ì„ íƒ ê°€ëŠ¥
                if (currentUser.is_lesson_instructor) {
                    reservationPurpose.innerHTML += `<option value="lesson">ê¸°íƒ€ ê°•ìŠµ</option>`;
                }
                if (currentUser.is_admin) {
                    const adminOptions = { 'lesson': 'ê¸°íƒ€ ê°•ìŠµ', 'meeting': 'ì§‘ë¶€ íšŒì˜', 'other': 'ê¸°íƒ€' };
                    for (const [value, text] of Object.entries(adminOptions)) {
                        // ê¸°íƒ€ ê°•ìŠµìëŠ” ì´ë¯¸ ì¶”ê°€ë˜ì—ˆìœ¼ë¯€ë¡œ ì¤‘ë³µ ë°©ì§€
                        if (value === 'lesson' && currentUser.is_lesson_instructor) continue;
                        reservationPurpose.innerHTML += `<option value="${value}">${text}</option>`;
                    }
                }
                
                reservationDuration.innerHTML = '';
                const maxDuration = 120;
                const otherReservations = existingReservation ? reservations.filter(r => r.id !== existingReservation.id) : reservations;

                for (let duration = 30; duration <= maxDuration; duration += 30) {
                    const endTime = new Date(startTime.getTime() + duration * 60000);
                    const closingTime = new Date(startTime);
                    closingTime.setHours(22, 0, 0, 0);

                    if (endTime > closingTime) break;

                    const isOverlapping = otherReservations.some(r => 
                        (startTime < r.end_time && endTime > r.start_time)
                    );

                    if (!isOverlapping) {
                        const hours = Math.floor(duration / 60);
                        const minutes = duration % 60;
                        let durationText = '';
                        if (hours > 0) durationText += `${hours}ì‹œê°„ `;
                        if (minutes > 0) durationText += `${minutes}ë¶„`;
                        
                        reservationDuration.innerHTML += `<option value="${duration}">${durationText.trim()}</option>`;
                    } else {
                        break; 
                    }
                }

                document.getElementById('reservation-start-time').value = startTime.toISOString();
                
                if (existingReservation) {
                    reservationPurpose.value = existingReservation.purpose;
                    const duration = (existingReservation.end_time - existingReservation.start_time) / 60000;
                    reservationDuration.value = duration;
                    if (existingReservation.purpose === 'performance') {
                        document.getElementById('performance-name').value = existingReservation.performance_name;
                        performanceNameWrapper.classList.remove('hidden');
                    }
                    participantsInput.value = existingReservation.participants.map(p => p.nickname).join(', ');
                } else {
                    participantsInput.value = currentUser.nickname + ', ';
                }
                
                renderParticipantSuggestions('');
                participantsInput.addEventListener('input', handleParticipantSearch);
                

                modalFormContent.onsubmit = handleReservationSubmit;

                document.getElementById('close-form-modal-btn').onclick = closeModal;
                reservationModal.classList.remove('hidden');
            }
            
            document.getElementById('participant-suggestion-list').addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    const nicknameToAdd = e.target.textContent;
                    const input = participantsInput;
                    let currentTerms = input.value.split(',').map(p => p.trim());
                    const lastTerm = currentTerms.pop() || '';
                    
                    const isLastTermValidUser = users.some(u => u.nickname === lastTerm);

                    let newTerms = isLastTermValidUser ? [...currentTerms, lastTerm] : [...currentTerms];
                    
                    if (!newTerms.includes(nicknameToAdd)) {
                        newTerms.push(nicknameToAdd);
                    }
                    
                    input.value = newTerms.join(', ') + (newTerms.length > 0 ? ', ' : '');
                    input.focus();
                    handleParticipantSearch({ target: input });
                }
            });
            
            reservationPurpose.addEventListener('change', (e) => {
                performanceNameWrapper.classList.toggle('hidden', e.target.value !== 'performance');
            });

            async function handleReservationSubmit(e) {
                e.preventDefault();
                const editingId = document.getElementById('edit-reservation-id').value;
                const startTime = new Date(document.getElementById('reservation-start-time').value);
                const purpose = reservationPurpose.value;
                const duration = parseInt(reservationDuration.value);
                const endTime = new Date(startTime.getTime() + duration * 60000);
                const performanceName = document.getElementById('performance-name').value;
                const participantNicknames = participantsInput.value.split(',').map(n => n.trim()).filter(Boolean);

                const now = getKoreaTime();
                const reservationDate = setKoreaTime(startTime, 0, 0, 0);
                
                const today = setKoreaTime(getKoreaTime(), 0, 0, 0);


                if (!currentUser.is_admin) {
                     if (purpose === 'personal') {
                        // ê°œì¸ ì—°ìŠµì€ ë‹¹ì¼ê³¼ ë‹¤ìŒë‚ ë§Œ ì˜ˆì•½ ê°€ëŠ¥
                        const personalEnd = new Date(today);
                        personalEnd.setDate(today.getDate() + 1);
                        
                        if (reservationDate < today || reservationDate > personalEnd) {
                            showModalError('ê°œì¸ ì—°ìŠµì€ ë‹¹ì¼ê³¼ ë‹¤ìŒë‚ ë§Œ ì˜ˆì•½ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                            return;
                        }
                    } else if (purpose === 'performance') {
                        // ê³µì—° ì—°ìŠµì€ ë‹¹ì¼ë¶€í„° 7ì¼ ì „ê¹Œì§€ ì˜ˆì•½ ê°€ëŠ¥
                        const performanceEnd = new Date(today);
                        performanceEnd.setDate(today.getDate() + 7);

                        if (reservationDate < today || reservationDate > performanceEnd) {
                            showModalError('ê³µì—° ì—°ìŠµì€ ë‹¹ì¼ë¶€í„° 7ì¼ ì „ê¹Œì§€ ì˜ˆì•½ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                            return;
                        }
                    } else if (purpose === 'lesson') {
                        // ê¸°íƒ€ ê°•ìŠµìëŠ” 1ë‹¬ ë’¤ê¹Œì§€ ì˜ˆì•½ ê°€ëŠ¥
                        if (currentUser.is_lesson_instructor) {
                            const lessonLimit = new Date(today);
                            lessonLimit.setMonth(today.getMonth() + 1);
                            if (reservationDate < today || reservationDate > lessonLimit) {
                                showModalError('ê¸°íƒ€ ê°•ìŠµì€ ë‹¹ì¼ë¶€í„° 1ë‹¬ ë’¤ê¹Œì§€ ì˜ˆì•½ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                                return;
                            }
                        } else {
                            showModalError('ê¸°íƒ€ ê°•ìŠµ ì˜ˆì•½ì€ ê¸°íƒ€ ê°•ìŠµìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                            return;
                        }
                    }
                }
                // ê´€ë¦¬ìëŠ” ë‚ ì§œ ì œí•œ ì—†ìŒ (ì œí•œ ì œê±°ë¨)
                
                // ê´€ë¦¬ìê°€ ì•„ë‹ˆê³  ìˆ˜ì • ì¤‘ì´ ì•„ë‹ ë•Œë§Œ ê³¼ê±° ì‹œê°„ ì²´í¬
                if (!currentUser.is_admin && startTime < now && !editingId) {
                    showModalError('ê³¼ê±° ì‹œê°„ì€ ì˜ˆì•½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                if (purpose === 'performance' && !performanceName) {
                    showModalError('ê³µì—°ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                if (participantNicknames.length === 0) {
                    showModalError('ì°¸ì—¬ìë¥¼ 1ëª… ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                const participants = [];
                for (const nickname of participantNicknames) {
                    const user = users.find(u => u.nickname === nickname);
                    if (!user) {
                        showModalError(`'${nickname}'ë‹˜ì€ ìœ íš¨í•œ íšŒì›ì´ ì•„ë‹™ë‹ˆë‹¤.`);
                        return;
                    }
                    if (!user.can_reserve) {
                        showModalError(`'${nickname}'ë‹˜ì€ ì˜ˆì•½ì´ ë¹„í™œì„±í™” ìƒíƒœì…ë‹ˆë‹¤.`);
                        return;
                    }
                    participants.push(user);
                }
                
                const otherReservations = editingId ? reservations.filter(r => r.id != editingId) : reservations;
                const isOverlapping = otherReservations.some(r => 
                    (startTime < r.end_time && endTime > r.start_time)
                );

                if (isOverlapping) {
                    showModalError('í•´ë‹¹ ì‹œê°„ëŒ€ì— ì´ë¯¸ ë‹¤ë¥¸ ì˜ˆì•½ì´ ì¡´ì¬í•©ë‹ˆë‹¤.');
                    return;
                }
                
                const reservationData = {
                    booker_id: currentUser.id,
                    booker: currentUser,
                    start_time: Timestamp.fromDate(startTime),
                    end_time: Timestamp.fromDate(endTime),
                    purpose: purpose,
                    performance_name: purpose === 'performance' ? performanceName : null,
                    participants: participants
                };

                try {
                    if (editingId) {
                       await updateDoc(doc(db, 'reservations', editingId), reservationData);
                    } else {
                       await addDoc(collection(db, 'reservations'), reservationData);
                    }
                } catch(error) {
                    console.error("ì˜ˆì•½ ì €ì¥ ì˜¤ë¥˜:", error);
                    showModalError("ì˜ˆì•½ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                    return;
                }
                
                closeModal();
            }
            
            function showModalError(message) {
                modalError.textContent = message;
                modalError.classList.remove('hidden');
            }

            function closeModal() {
                participantsInput.removeEventListener('input', handleParticipantSearch);
                reservationModal.classList.add('hidden');
                editUserModal.classList.add('hidden');
                editProfileModal.classList.add('hidden');
                confirmationModal.classList.add('hidden');
            }

            function showConfirmation(title, message, onConfirm) {
                document.getElementById('confirmation-title').textContent = title;
                document.getElementById('confirmation-message').textContent = message;
                confirmationModal.classList.remove('hidden');

                const yesBtn = document.getElementById('confirm-yes-btn');
                const noBtn = document.getElementById('confirm-no-btn');

                const newYesBtn = yesBtn.cloneNode(true);
                yesBtn.parentNode.replaceChild(newYesBtn, yesBtn);
                
                newYesBtn.addEventListener('click', () => {
                    onConfirm();
                    closeModal();
                });

                noBtn.onclick = closeModal;
            }
            
            // ê³µì§€ì‚¬í•­ íšŒì› ì¡´ì¬ ì—¬ë¶€ í™•ì¸ í•¨ìˆ˜
            function checkNoticeUser() {
                const noticeUser = users.find(u => u && u.name === 'ê³µì§€ì‚¬í•­' && u.student_id === 'notice');
                if (noticeUser) {
                    console.log('âš ï¸ ì‹¤ì œ "ê³µì§€ì‚¬í•­"ì´ë¼ëŠ” íšŒì›ì´ ì¡´ì¬í•©ë‹ˆë‹¤:', noticeUser);
                    console.log('ì´ íšŒì›ì€ ê³µì§€ì‚¬í•­ ì‹œìŠ¤í…œìš©ìœ¼ë¡œ ìƒì„±ëœ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.');
                    console.log('ì˜ˆì•½ ì°¸ê°€ì ëª©ë¡ì—ì„œ ì œì™¸ë©ë‹ˆë‹¤.');
                    return true;
                } else {
                    console.log('âœ… ì‹¤ì œ "ê³µì§€ì‚¬í•­" íšŒì›ì€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    return false;
                }
            }

            // ì˜ëª»ëœ ê³µì§€ì‚¬í•­ ë¬¸ì„œ ì •ë¦¬ í•¨ìˆ˜
            async function cleanupInvalidNotices() {
                try {
                    console.log('ì˜ëª»ëœ ê³µì§€ì‚¬í•­ ë¬¸ì„œ ì •ë¦¬ ì‹œì‘');
                    const invalidNotices = users.filter(u => 
                        u && u.content && !u.is_notice && !u.name && !u.student_id
                    );
                    
                    console.log('ì •ë¦¬í•  ì˜ëª»ëœ ê³µì§€ì‚¬í•­:', invalidNotices);
                    
                    for (const notice of invalidNotices) {
                        console.log(`ê³µì§€ì‚¬í•­ ${notice.id} ì‚­ì œ ì¤‘...`);
                        await deleteDoc(doc(db, 'users', notice.id));
                        console.log(`ê³µì§€ì‚¬í•­ ${notice.id} ì‚­ì œ ì™„ë£Œ`);
                    }
                    
                    if (invalidNotices.length > 0) {
                        console.log(`${invalidNotices.length}ê°œì˜ ì˜ëª»ëœ ê³µì§€ì‚¬í•­ ë¬¸ì„œë¥¼ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.`);
                    }
                } catch (error) {
                    console.error('ê³µì§€ì‚¬í•­ ì •ë¦¬ ì˜¤ë¥˜:', error);
                }
            }

            // Admin Panel Logic
            function renderUserManagementTable() {
                const container = document.getElementById('user-management-tables-container');
                if (!container) {
                    console.error('user-management-tables-containerë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                container.innerHTML = '';
                
                console.log('ì „ì²´ users ë°°ì—´:', users);
                console.log('users ë°°ì—´ ê¸¸ì´:', users.length);
                
                // ì‹¤ì œ Firebase ë°ì´í„° ì‚¬ìš© - ë” ì—„ê²©í•œ í•„í„°ë§
                const allDisplayUsers = users.filter(u => {
                    // ê¸°ë³¸ ì‚¬ìš©ì í•„ë“œê°€ ìˆëŠ”ì§€ í™•ì¸
                    const hasUserFields = u && u.name && u.student_id && u.email;
                    // ê³µì§€ì‚¬í•­ì´ ì•„ë‹Œì§€ í™•ì¸
                    const isNotNotice = !u.is_notice && !u.content;
                    // ê´€ë¦¬ìê°€ ì•„ë‹Œì§€ í™•ì¸
                    const isNotAdmin = !u.is_admin;
                    
                    console.log(`ì‚¬ìš©ì ${u.id} í•„í„°ë§:`, {
                        hasUserFields,
                        isNotNotice,
                        isNotAdmin,
                        result: hasUserFields && isNotNotice && isNotAdmin
                    });
                    
                    return hasUserFields && isNotNotice && isNotAdmin;
                });
                console.log('í‘œì‹œí•  ì‚¬ìš©ìë“¤:', allDisplayUsers);
                
                if (allDisplayUsers.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8">
                            <h3 class="text-lg font-semibold text-gray-600 mb-2">ë“±ë¡ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                            <p class="text-gray-500">ì•„ì§ ë“±ë¡ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                            <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                <h4 class="font-semibold text-blue-800">ë””ë²„ê¹… ì •ë³´:</h4>
                                <p class="text-sm text-blue-700">ì „ì²´ ì‚¬ìš©ì ìˆ˜: ${users.length}</p>
                                <p class="text-sm text-blue-700">ê´€ë¦¬ì ìˆ˜: ${users.filter(u => u.is_admin).length}</p>
                                <p class="text-sm text-blue-700">ê³µì§€ì‚¬í•­ ìˆ˜: ${users.filter(u => u.is_notice).length}</p>
                                <p class="text-sm text-blue-700">ì¼ë°˜ ì‚¬ìš©ì ìˆ˜: ${allDisplayUsers.length}</p>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                const enabledUsers = allDisplayUsers.filter(u => u && u.can_reserve !== false).sort((a,b) => {
                    const aId = (a && a.student_id) || '';
                    const bId = (b && b.student_id) || '';
                    return aId.localeCompare(bId);
                });
                const disabledUsers = allDisplayUsers.filter(u => u && u.can_reserve === false).sort((a,b) => {
                    const aId = (a && a.student_id) || '';
                    const bId = (b && b.student_id) || '';
                    return aId.localeCompare(bId);
                });

                const createTableForGroup = (title, userGroup) => {
                    if (userGroup.length === 0 && title.includes('ë¹„í™œì„±')) {
                        return `<div><h3 class="text-lg font-semibold mb-2">${title} (0ëª…)</h3><p class="text-gray-500">í•´ë‹¹í•˜ëŠ” íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>`
                    };
                    
                    const rows = userGroup.filter(user => user && user.id).map(user => `
                        <tr class="bg-white">
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.name || 'N/A'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.nickname || 'N/A'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.student_id || 'N/A'}</td>
                            <td class="px-6 py-4 whitespace-nowrap font-mono text-sm text-gray-500">${user.password || 'N/A'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.phone_number || 'N/A'}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <label class="flex items-center cursor-pointer">
                                    <div class="relative">
                                        <input type="checkbox" class="sr-only can-reserve-toggle" data-user-id="${user.id}" ${user.can_reserve ? 'checked' : ''}>
                                        <div class="block bg-gray-600 w-14 h-8 rounded-full"></div>
                                        <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition"></div>
                                    </div>
                                </label>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <label class="flex items-center cursor-pointer">
                                    <div class="relative">
                                        <input type="checkbox" class="sr-only lesson-instructor-toggle" data-user-id="${user.id}" ${user.is_lesson_instructor ? 'checked' : ''}>
                                        <div class="block bg-gray-600 w-14 h-8 rounded-full"></div>
                                        <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition"></div>
                                    </div>
                                </label>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-4">
                                <button class="edit-user-btn text-indigo-600 hover:text-indigo-900" data-user-id="${user.id}">ìˆ˜ì •</button>
                            </td>
                        </tr>
                    `).join('');

                    return `
                        <div>
                            <h3 class="text-lg font-semibold mb-2">${title} (${userGroup.length}ëª…)</h3>
                            <div class="overflow-x-auto border rounded-lg">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì´ë¦„</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ë³„ëª…</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">í•™ë²ˆ</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ë¹„ë°€ë²ˆí˜¸</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì „í™”ë²ˆí˜¸</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì˜ˆì•½ ê¶Œí•œ</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ê¸°íƒ€ ê°•ìŠµì</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ê´€ë¦¬</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        ${rows}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                };
                
                container.innerHTML += createTableForGroup('ì˜ˆì•½ ê°€ëŠ¥ íšŒì›', enabledUsers);
                container.innerHTML += createTableForGroup('ì˜ˆì•½ ë¹„í™œì„± íšŒì›', disabledUsers);

                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                container.querySelectorAll('.can-reserve-toggle, .lesson-instructor-toggle, .edit-user-btn').forEach(btn => {
                    const eventType = btn.classList.contains('can-reserve-toggle') || btn.classList.contains('lesson-instructor-toggle') ? 'change' : 'click';
                    btn.addEventListener(eventType, handleAdminActions);
                });
            }

            async function handleAdminActions(e) {
                console.log('handleAdminActions í˜¸ì¶œë¨');
                console.log('ì´ë²¤íŠ¸ íƒ€ê²Ÿ:', e.target);
                console.log('íƒ€ê²Ÿ í´ë˜ìŠ¤:', e.target.className);
                
                const target = e.target;
                const userId = target.dataset.userId;
                console.log('ì‚¬ìš©ì ID:', userId);
                
                const user = users.find(u => u.id === userId);
                console.log('ì°¾ì€ ì‚¬ìš©ì:', user);
                if (!user) return;

                if (target.classList.contains('can-reserve-toggle')) {
                    const isEnabling = target.checked;
                    const userDocRef = doc(db, 'users', userId);
                    if (isEnabling) {
                        await updateDoc(userDocRef, { can_reserve: true });
                    } else {
                        showConfirmation('ê¶Œí•œ ë¹„í™œì„±í™”', `'${user.nickname}'ë‹˜ì˜ ì˜ˆì•½ ê¶Œí•œì„ ë¹„í™œì„±í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? í•´ë‹¹ íšŒì›ì´ ì˜ˆì•½í–ˆê±°ë‚˜ ì°¸ì—¬ìë¡œ ì§€ì •ëœ ëª¨ë“  í–¥í›„ ì¼ì •ì´ ì‚­ì œë©ë‹ˆë‹¤.`, async () => {
                            await updateDoc(userDocRef, { can_reserve: false });
                            const now = getKoreaTime();
                            const batch = writeBatch(db);
                            
                            const userReservations = reservations.filter(r => {
                                const isBooker = r.booker_id === user.id;
                                const isParticipant = r.participants.some(p => p.id === user.id);
                                return r.start_time >= now && (isBooker || isParticipant);
                            });

                            userReservations.forEach(r => {
                                const resDocRef = doc(db, 'reservations', r.id);
                                if (r.booker_id === user.id) {
                                    batch.delete(resDocRef);
                                } else {
                                    const updatedParticipants = r.participants.filter(p => p.id !== user.id);
                                    batch.update(resDocRef, { participants: updatedParticipants });
                                }
                            });
                            await batch.commit();
                        });
                        e.target.checked = user.can_reserve;
                    }
                } else if (target.classList.contains('lesson-instructor-toggle')) {
                    // ê¸°íƒ€ ê°•ìŠµì í† ê¸€ ì²˜ë¦¬
                    const isEnabling = target.checked;
                    const userDocRef = doc(db, 'users', userId);
                    await updateDoc(userDocRef, { is_lesson_instructor: isEnabling });
                } else if (target.classList.contains('edit-user-btn')) {
                    console.log('íšŒì› ìˆ˜ì • ë²„íŠ¼ í´ë¦­ë¨');
                    console.log('ìˆ˜ì •í•  ì‚¬ìš©ì:', user);
                    
                    document.getElementById('edit-user-id').value = user.id;
                    document.getElementById('edit-user-name').value = user.name;
                    document.getElementById('edit-user-student-id').value = user.student_id;
                    document.getElementById('edit-user-phone').value = user.phone_number;
                    document.getElementById('edit-user-password').value = ''; // ë¹„ë°€ë²ˆí˜¸ í•„ë“œ ì´ˆê¸°í™”
                    
                    console.log('ëª¨ë‹¬ í‘œì‹œ');
                    editUserModal.classList.remove('hidden');
                }
            }
            
            document.getElementById('edit-user-form').addEventListener('submit', async (e) => {
                console.log('íšŒì› ìˆ˜ì • í¼ ì œì¶œë¨');
                e.preventDefault();
                
                const userId = document.getElementById('edit-user-id').value;
                console.log('ìˆ˜ì •í•  ì‚¬ìš©ì ID:', userId);
                
                const userDocRef = doc(db, 'users', userId);
                
                const newName = document.getElementById('edit-user-name').value;
                const newStudentId = document.getElementById('edit-user-student-id').value;
                const newPassword = document.getElementById('edit-user-password').value;

                const updateData = {
                    name: newName,
                    student_id: newStudentId,
                    phone_number: document.getElementById('edit-user-phone').value,
                    nickname: createNickname(newName, newStudentId),
                    department_code: newStudentId.substring(4, 6)
                };

                // ë¹„ë°€ë²ˆí˜¸ê°€ ì…ë ¥ëœ ê²½ìš° Firestoreì— ì €ì¥
                if (newPassword) {
                    updateData.password = newPassword;
                }

                console.log('ì—…ë°ì´íŠ¸í•  ë°ì´í„°:', updateData);
                
                try {
                    await updateDoc(userDocRef, updateData);
                    console.log('ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸ ì„±ê³µ');
                    closeModal();
                } catch (error) {
                    console.error('ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                    alert('ì‚¬ìš©ì ì •ë³´ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            });
            
            document.getElementById('close-edit-modal-btn').onclick = closeModal;
            
            // User Profile Edit Logic
            editProfileBtn.addEventListener('click', () => {
                document.getElementById('edit-profile-name').value = currentUser.name;
                document.getElementById('edit-profile-student-id').value = currentUser.student_id;
                document.getElementById('edit-profile-phone').value = currentUser.phone_number;
                document.getElementById('current-email-display').textContent = currentUser.email;
                document.getElementById('edit-profile-password').value = '';
                document.getElementById('edit-profile-error').classList.add('hidden');
                editProfileModal.classList.remove('hidden');
            });

            document.getElementById('close-edit-profile-modal-btn').onclick = closeModal;
            
            document.getElementById('edit-profile-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const errorEl = document.getElementById('edit-profile-error');
                const newName = document.getElementById('edit-profile-name').value;
                const newStudentId = document.getElementById('edit-profile-student-id').value;
                const newPhone = document.getElementById('edit-profile-phone').value;
                const newPassword = document.getElementById('edit-profile-password').value;

                const q = query(collection(db, 'users'), where("student_id", "==", newStudentId));
                const querySnapshot = await getDocs(q);
                const studentIdExists = !querySnapshot.empty && querySnapshot.docs[0].id !== currentUser.id;

                if (studentIdExists) {
                    errorEl.textContent = 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ í•™ë²ˆì…ë‹ˆë‹¤.';
                    errorEl.classList.remove('hidden');
                    return;
                }

                const userDocRef = doc(db, 'users', currentUser.id);
                const updatedData = {
                    name: newName,
                    student_id: newStudentId,
                    phone_number: newPhone,
                    nickname: createNickname(newName, newStudentId),
                    department_code: newStudentId.substring(4, 6)
                };
                
                // ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ëœ ê²½ìš° Firestoreì—ë„ ì €ì¥
                if (newPassword) {
                    updatedData.password = newPassword;
                }
                
                try {
                    if (newPassword) {
                        await updatePassword(firebaseUser, newPassword);
                    }
                    await updateDoc(userDocRef, updatedData);
                    
                    const updatedUser = { ...currentUser, ...updatedData };
                     const batch = writeBatch(db);
                     reservations.forEach(r => {
                        let reservationNeedsUpdate = false;
                        if(r.booker.id === currentUser.id) {
                           r.booker = updatedUser;
                           reservationNeedsUpdate = true;
                        }
                        const participantIndex = r.participants.findIndex(p => p.id === currentUser.id);
                        if(participantIndex > -1) {
                            r.participants[participantIndex] = updatedUser;
                            reservationNeedsUpdate = true;
                        }
                        if(reservationNeedsUpdate) {
                             const resDocRef = doc(db, 'reservations', r.id);
                             batch.update(resDocRef, { booker: r.booker, participants: r.participants });
                        }
                     });
                     await batch.commit();

                    closeModal();

                } catch(error) {
                    console.error("Profile update error", error);
                    errorEl.textContent = 'ì •ë³´ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (ìµœê·¼ì— ë¡œê·¸ì¸í–ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”)';
                    errorEl.classList.remove('hidden');
                }
            });

            function renderMyReservations() {
                const container = document.getElementById('my-reservations-list-container');
                const now = getKoreaTime();
                const myUpcomingReservations = reservations
                    .filter(r => r.start_time >= now && (r.booker_id === currentUser.id || r.participants.some(p => p.id === currentUser.id)))
                    .sort((a, b) => a.start_time - b.start_time);
                
                if (myUpcomingReservations.length === 0) {
                    container.innerHTML = `<p class="text-center text-gray-500">ì˜ˆì •ëœ ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
                    return;
                }

                const rows = myUpcomingReservations.map(r => {
                     const date = r.start_time.toLocaleDateString('ko-KR');
                     const startTime = r.start_time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                     const endTime = r.end_time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                     const participants = r.participants.map(p => p.nickname).join(', ');
                     const isParticipant = r.participants.some(p => p.id === currentUser.id);
                     const canModify = r.booker_id === currentUser.id || currentUser.is_admin || isParticipant;
                     
                     return `
                        <tr class="bg-white">
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${date}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${startTime} - ${endTime}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${getPurposeDisplayName(r.purpose)}</td>
                            <td class="px-6 py-4 text-sm text-gray-900 min-w-[250px]">${participants}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-4">
                                ${canModify ? `<button class="edit-my-reservation-btn text-indigo-600 hover:text-indigo-900" data-reservation-id="${r.id}">ìˆ˜ì •</button>` : ''}
                                ${canModify ? `<button class="cancel-my-reservation-btn text-red-600 hover:text-red-900" data-reservation-id="${r.id}">ì·¨ì†Œ</button>` : ''}
                            </td>
                        </tr>
                     `;
                }).join('');

                container.innerHTML = `
                    <div class="overflow-x-auto border rounded-lg">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ë‚ ì§œ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì‹œê°„</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ëª©ì </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì°¸ì—¬ì</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                ${rows}
                            </tbody>
                        </table>
                    </div>
                `;

                container.querySelectorAll('.edit-my-reservation-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const resId = e.target.dataset.reservationId;
                        const reservation = reservations.find(r => r.id === resId);
                        if (reservation) showReservationFormModal(reservation.start_time, reservation);
                    });
                });

                container.querySelectorAll('.cancel-my-reservation-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const resId = e.target.dataset.reservationId;
                        showConfirmation('ì˜ˆì•½ ì·¨ì†Œ', 'ì´ ì˜ˆì•½ì„ ì •ë§ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', async () => {
                           await deleteDoc(doc(db, 'reservations', resId));
                        });
                    });
                });
            }

            initializeAppWithFirebase();
        });
    </script>
</body>
</html>

<!-- 
===========================================
ë™ì•„ë¦¬ë°© ì˜ˆì•½ ì‹œìŠ¤í…œ ìˆ˜ì • ê°€ì´ë“œ
===========================================

ì´ ê°€ì´ë“œëŠ” ì½”ë”©ì„ ëª¨ë¥´ëŠ” ì‚¬ëŒë„ ì‰½ê²Œ ì‹œìŠ¤í…œì„ ìˆ˜ì •í•  ìˆ˜ ìˆë„ë¡ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
ê° ì„¹ì…˜ë³„ë¡œ ìˆ˜ì • ë°©ë²•ì„ ìì„¸íˆ ì„¤ëª…í•©ë‹ˆë‹¤.

===========================================
1. ê¸°ë³¸ í…ìŠ¤íŠ¸ ìˆ˜ì •í•˜ê¸°
===========================================

1-1. ì•± ì œëª© ë³€ê²½
- ì°¾ì„ ìœ„ì¹˜: <title>ë™ì•„ë¦¬ë°© ì˜ˆì•½ ì‹œìŠ¤í…œ</title> (25ë²ˆì§¸ ì¤„)
- ìˆ˜ì • ë°©ë²•: "ë™ì•„ë¦¬ë°© ì˜ˆì•½ ì‹œìŠ¤í…œ"ì„ ì›í•˜ëŠ” ì œëª©ìœ¼ë¡œ ë³€ê²½

1-2. ë¡œê·¸ì¸ í™”ë©´ ì œëª© ë³€ê²½
- ì°¾ì„ ìœ„ì¹˜: <h2 class="text-2xl font-bold text-center">ë™ì•„ë¦¬ë°© ì˜ˆì•½ ì‹œìŠ¤í…œ ë¡œê·¸ì¸</h2> (304ë²ˆì§¸ ì¤„)
- ìˆ˜ì • ë°©ë²•: "ë™ì•„ë¦¬ë°© ì˜ˆì•½ ì‹œìŠ¤í…œ ë¡œê·¸ì¸"ì„ ì›í•˜ëŠ” í…ìŠ¤íŠ¸ë¡œ ë³€ê²½

1-3. ê³µì§€ì‚¬í•­ ì œëª© ë³€ê²½
- ì°¾ì„ ìœ„ì¹˜: <h3 class="text-lg font-bold mb-4">ğŸ“¢ ê³µì§€ì‚¬í•­</h3> (395ë²ˆì§¸ ì¤„)
- ìˆ˜ì • ë°©ë²•: "ğŸ“¢ ê³µì§€ì‚¬í•­"ì„ ì›í•˜ëŠ” í…ìŠ¤íŠ¸ë¡œ ë³€ê²½

===========================================
2. ìƒ‰ìƒ ë³€ê²½í•˜ê¸°
===========================================

2-1. ì˜ˆì•½ ëª©ì ë³„ ìƒ‰ìƒ ë³€ê²½
- ì°¾ì„ ìœ„ì¹˜: CSS ìŠ¤íƒ€ì¼ ì„¹ì…˜ (77-97ë²ˆì§¸ ì¤„)
- ìˆ˜ì • ë°©ë²•: background-colorì™€ color ê°’ì„ ì›í•˜ëŠ” ìƒ‰ìƒ ì½”ë“œë¡œ ë³€ê²½
  ì˜ˆì‹œ: #A3BFFA (ì—°í•œ íŒŒë€ìƒ‰) â†’ #FFB6C1 (ì—°í•œ í•‘í¬ìƒ‰)

2-2. ë²„íŠ¼ ìƒ‰ìƒ ë³€ê²½
- ì°¾ì„ ìœ„ì¹˜: HTMLì˜ class ì†ì„±ì—ì„œ bg-ìƒ‰ìƒëª… ë¶€ë¶„
- ìˆ˜ì • ë°©ë²•: bg-green-500 â†’ bg-blue-500 (ì´ˆë¡ìƒ‰ â†’ íŒŒë€ìƒ‰)
- ì‚¬ìš© ê°€ëŠ¥í•œ ìƒ‰ìƒ: red, blue, green, yellow, purple, pink, gray ë“±

2-3. ë°°ê²½ìƒ‰ ë³€ê²½
- ì°¾ì„ ìœ„ì¹˜: CSSì˜ background-color: #F8F7F4 (58ë²ˆì§¸ ì¤„)
- ìˆ˜ì • ë°©ë²•: #F8F7F4ë¥¼ ì›í•˜ëŠ” ìƒ‰ìƒ ì½”ë“œë¡œ ë³€ê²½

===========================================
3. ì˜ˆì•½ ëª©ì  ì¶”ê°€/ìˆ˜ì •í•˜ê¸°
===========================================

3-1. ì˜ˆì•½ ëª©ì  ì¶”ê°€
- ì°¾ì„ ìœ„ì¹˜: JavaScriptì˜ PURPOSE_MAP (774-780ë²ˆì§¸ ì¤„)
- ìˆ˜ì • ë°©ë²•: ìƒˆ ëª©ì ì„ ì¶”ê°€
  ì˜ˆì‹œ: 'workshop': 'ì›Œí¬ìƒµ' ì¶”ê°€

3-2. ì˜ˆì•½ ëª©ì  ìƒ‰ìƒ ì¶”ê°€
- ì°¾ì„ ìœ„ì¹˜: CSS ìŠ¤íƒ€ì¼ ì„¹ì…˜ (77-97ë²ˆì§¸ ì¤„)
- ìˆ˜ì • ë°©ë²•: ìƒˆ CSS í´ë˜ìŠ¤ ì¶”ê°€
  ì˜ˆì‹œ: .is-reserved-workshop { background-color: #FFE4E1; color: #8B0000; }

===========================================
4. í•™ê³¼ ì¶”ê°€/ìˆ˜ì •í•˜ê¸°
===========================================

4-1. í•™ê³¼ ì¶”ê°€
- ì°¾ì„ ìœ„ì¹˜: JavaScriptì˜ DEPT_MAP (767-771ë²ˆì§¸ ì¤„)
- ìˆ˜ì • ë°©ë²•: ìƒˆ í•™ê³¼ ì½”ë“œì™€ ì´ë¦„ ì¶”ê°€
  ì˜ˆì‹œ: '14': 'ì²´ìœ¡êµìœ¡' ì¶”ê°€

===========================================
5. ì‹œê°„ ì„¤ì • ë³€ê²½í•˜ê¸°
===========================================

5-1. ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„ ë³€ê²½
- ì°¾ì„ ìœ„ì¹˜: JavaScript ì½”ë“œì—ì„œ ì‹œê°„ ê´€ë ¨ ë¶€ë¶„ì„ ì°¾ì•„ì„œ ìˆ˜ì •
- ìˆ˜ì • ë°©ë²•: ì‹œê°„ ë°°ì—´ì´ë‚˜ ì¡°ê±´ë¬¸ì—ì„œ ì›í•˜ëŠ” ì‹œê°„ìœ¼ë¡œ ë³€ê²½

5-2. ì‹œê°„ëŒ€ ë³€ê²½ (ë‹¤ë¥¸ êµ­ê°€ ì‚¬ìš© ì‹œ)
- ì°¾ì„ ìœ„ì¹˜: getKoreaTime í•¨ìˆ˜ (796ë²ˆì§¸ ì¤„)
- ìˆ˜ì • ë°©ë²•: UTC+9ë¥¼ ì›í•˜ëŠ” ì‹œê°„ëŒ€ë¡œ ë³€ê²½
  ì˜ˆì‹œ: UTC+8 (ì‹±ê°€í¬ë¥´) ì‚¬ìš© ì‹œ: (8 * 3600000)

===========================================
6. ê´€ë¦¬ì ê³„ì • ì„¤ì • ë³€ê²½í•˜ê¸°
===========================================

6-1. ê´€ë¦¬ì ì´ë©”ì¼ ë³€ê²½
- ì°¾ì„ ìœ„ì¹˜: adminUser ê°ì²´ (981ë²ˆì§¸ ì¤„)
- ìˆ˜ì • ë°©ë²•: email: 'admin@admin.com'ì„ ì›í•˜ëŠ” ì´ë©”ì¼ë¡œ ë³€ê²½

6-2. ê´€ë¦¬ì ì •ë³´ ë³€ê²½
- ì°¾ì„ ìœ„ì¹˜: adminUser ê°ì²´ (980-989ë²ˆì§¸ ì¤„)
- ìˆ˜ì • ë°©ë²•: ê° í•„ë“œì˜ ê°’ì„ ì›í•˜ëŠ” ê°’ìœ¼ë¡œ ë³€ê²½

===========================================
7. í™”ë©´ í¬ê¸° ë³€ê²½í•˜ê¸°
===========================================

7-1. ëª¨ë°”ì¼ í™”ë©´ í¬ê¸° ë³€ê²½
- ì°¾ì„ ìœ„ì¹˜: CSSì˜ max-width: 375px (55ë²ˆì§¸ ì¤„)
- ìˆ˜ì • ë°©ë²•: 375pxë¥¼ ì›í•˜ëŠ” í¬ê¸°ë¡œ ë³€ê²½

7-2. ì „ì²´ í™”ë©´ìœ¼ë¡œ ë³€ê²½
- ì°¾ì„ ìœ„ì¹˜: CSSì˜ max-width: 375pxë¥¼ max-width: 100%ë¡œ ë³€ê²½

===========================================
8. Firebase ì„¤ì • ë³€ê²½í•˜ê¸°
===========================================

8-1. Firebase í”„ë¡œì íŠ¸ ì—°ê²°
- ì°¾ì„ ìœ„ì¹˜: firebaseConfig ê°ì²´ (705-712ë²ˆì§¸ ì¤„)
- ìˆ˜ì • ë°©ë²•: ë³¸ì¸ì˜ Firebase í”„ë¡œì íŠ¸ ì„¤ì •ìœ¼ë¡œ êµì²´
  1. Firebase ì½˜ì†”ì—ì„œ ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±
  2. ì›¹ ì•± ì¶”ê°€ í›„ ì„¤ì • ì •ë³´ ë³µì‚¬
  3. ì•„ë˜ ì„¤ì • ì •ë³´ë¥¼ êµì²´

===========================================
9. ê¸°ëŠ¥ ì¶”ê°€í•˜ê¸° (ê³ ê¸‰)
===========================================

9-1. ìƒˆ ë²„íŠ¼ ì¶”ê°€
1. HTMLì— ìƒˆ ë²„íŠ¼ ì¶”ê°€
2. JavaScriptì—ì„œ ë²„íŠ¼ ì°¸ì¡° ì¶”ê°€
3. í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€

9-2. ìƒˆ í™”ë©´ ì¶”ê°€
1. HTMLì— ìƒˆ div ì¶”ê°€
2. CSSë¡œ ìŠ¤íƒ€ì¼ë§
3. JavaScriptì—ì„œ í™”ë©´ ì „í™˜ í•¨ìˆ˜ ì¶”ê°€

===========================================
10. ì£¼ì˜ì‚¬í•­
===========================================

- ìˆ˜ì • ì „ì— ë°˜ë“œì‹œ íŒŒì¼ì„ ë°±ì—…í•˜ì„¸ìš”
- í•œ ë²ˆì— í•˜ë‚˜ì”© ìˆ˜ì •í•˜ê³  í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”
- í°ë”°ì˜´í‘œ(")ë‚˜ ì‘ì€ë”°ì˜´í‘œ(')ë¥¼ ì‹¤ìˆ˜ë¡œ ì‚­ì œí•˜ì§€ ë§ˆì„¸ìš”
- ê´„í˜¸()ë‚˜ ì¤‘ê´„í˜¸{}ë¥¼ ì‹¤ìˆ˜ë¡œ ì‚­ì œí•˜ì§€ ë§ˆì„¸ìš”
- ìƒ‰ìƒ ì½”ë“œëŠ” #ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” 6ìë¦¬ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ì„¸ìš”

===========================================
11. ë¬¸ì œ í•´ê²°
===========================================

ë¬¸ì œê°€ ë°œìƒí–ˆì„ ë•Œ:
1. ë¸Œë¼ìš°ì €ì˜ ê°œë°œì ë„êµ¬(F12)ë¥¼ ì—´ì–´ì„œ ì˜¤ë¥˜ ë©”ì‹œì§€ í™•ì¸
2. ë°±ì—… íŒŒì¼ë¡œ ë˜ëŒë¦¬ê¸°
3. ìˆ˜ì •í•œ ë¶€ë¶„ì„ ë‹¤ì‹œ í™•ì¸í•˜ê¸°
4. í•„ìš”ì‹œ ì „ë¬¸ê°€ì—ê²Œ ë¬¸ì˜í•˜ê¸°

===========================================
12. ì¶”ê°€ ë„ì›€ë§
===========================================

- HTML ê¸°ë³¸ ë¬¸ë²•: https://developer.mozilla.org/ko/docs/Web/HTML
- CSS ìƒ‰ìƒ ì½”ë“œ: https://www.color-hex.com/
- Firebase ì„¤ì •: https://firebase.google.com/docs/web/setup
- JavaScript ê¸°ë³¸: https://developer.mozilla.org/ko/docs/Web/JavaScript

ì´ ê°€ì´ë“œë¥¼ ë”°ë¼í•˜ë©´ ì½”ë”©ì„ ëª¨ë¥´ëŠ” ì‚¬ëŒë„ ì‰½ê²Œ ì‹œìŠ¤í…œì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ë©´ ê° ì„¹ì…˜ì˜ ì£¼ì„ì„ ì°¸ê³ í•˜ì„¸ìš”.
-->

